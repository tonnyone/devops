# Kubernetes 1.8+ PID Namespace 隔离与容器镜像适配

Kubernetes 从 1.8 版本开始，Pod 默认启用 PID namespace 隔离。每个容器拥有独立的 PID 1 进程，pause 容器不再负责收割所有容器的僵尸进程。

## 影响与问题
- 每个业务容器的 PID 1 必须自行处理子进程回收，否则会产生僵尸进程。
- 传统 ENTRYPOINT/COMMAND 直接运行业务进程，容易导致僵尸进程堆积。

## 镜像适配建议
- 基础镜像需集成 dumb-init、tini、gosu 等 init 工具，确保 PID 1 能正确处理 SIGCHLD、回收僵尸进程。
- 业务主进程要么自己处理子进程回收，要么用专用 init 工具作为 ENTRYPOINT。
- 主流官方镜像（如 nginx、python、node）都已集成 tini 或 dumb-init。

## 最佳实践
- 检查 Dockerfile，确保 ENTRYPOINT/COMMAND 前有 init 工具（如 tini/dumb-init）。
- 对于自定义镜像，建议加一层 init 管理，或在主进程中实现 SIGCHLD 处理。

## 参考
- https://github.com/krallin/tini
- https://github.com/Yelp/dumb-init
- https://kubernetes.io/docs/tasks/configure-pod-container/share-process-namespace/
