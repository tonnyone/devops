# linux ç½‘ç»œè™šæ‹ŸåŒ–

### linux namespace æœºåˆ¶

Linux Namespace æ˜¯ Linux å†…æ ¸æä¾›çš„ä¸€ç§èµ„æºéš”ç¦»æœºåˆ¶ï¼Œå®ƒå¯ä»¥è®©è¿›ç¨‹æ‹¥æœ‰ç‹¬ç«‹çš„ç³»ç»Ÿèµ„æºè§†å›¾ï¼Œæ˜¯å®¹å™¨æŠ€æœ¯çš„æ ¸å¿ƒåŸºç¡€ã€‚

#### ğŸ¯ ä»€ä¹ˆæ˜¯ Namespaceï¼Ÿ

**Namespaceï¼ˆå‘½åç©ºé—´ï¼‰** æ˜¯ Linux å†…æ ¸çš„ä¸€ä¸ªç‰¹æ€§ï¼Œå®ƒå°†ç³»ç»Ÿèµ„æºè¿›è¡Œéš”ç¦»ï¼Œä½¿å¾—ä¸åŒçš„è¿›ç¨‹ç»„å¯ä»¥æ‹¥æœ‰ç‹¬ç«‹çš„èµ„æºè§†å›¾ã€‚æ¯ä¸ª namespace å†…çš„è¿›ç¨‹åªèƒ½çœ‹åˆ°å±äºè‡ªå·± namespace çš„èµ„æºã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Host System                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Namespace A   â”‚     Namespace B       â”‚
â”‚                 â”‚                       â”‚
â”‚   Process 1     â”‚     Process 3         â”‚
â”‚   Process 2     â”‚     Process 4         â”‚
â”‚                 â”‚                       â”‚
â”‚   ç‹¬ç«‹çš„èµ„æºè§†å›¾ â”‚     ç‹¬ç«‹çš„èµ„æºè§†å›¾     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ğŸ—‚ï¸ Namespace çš„ç±»å‹

Linux å†…æ ¸ç›®å‰æ”¯æŒ 8 ç§ namespaceï¼Œå®ƒä»¬åœ¨ä¸åŒçš„å†…æ ¸ç‰ˆæœ¬ä¸­é€æ­¥å¼•å…¥ï¼š

##### 1. **PID Namespace (è¿›ç¨‹éš”ç¦»)** - `Linux 2.6.24 (2008å¹´)`
- **åŠŸèƒ½**: éš”ç¦»è¿›ç¨‹ ID ç©ºé—´
- **ç‰¹ç‚¹**: æ¯ä¸ª PID namespace æœ‰ç‹¬ç«‹çš„è¿›ç¨‹å·åˆ†é…
- **åº”ç”¨**: å®¹å™¨å†…è¿›ç¨‹ PID ä» 1 å¼€å§‹
- **å†å²**: æœ€æ—©å¼•å…¥çš„ namespace ä¹‹ä¸€ï¼Œä¸ºå®¹å™¨æŠ€æœ¯å¥ å®šåŸºç¡€

```bash
# æŸ¥çœ‹å½“å‰è¿›ç¨‹çš„ PID namespace
ls -la /proc/self/ns/pid

# åˆ›å»ºæ–°çš„ PID namespace
unshare --pid --fork --mount-proc /bin/bash

# åœ¨æ–° namespace ä¸­æŸ¥çœ‹è¿›ç¨‹
ps aux  # åªèƒ½çœ‹åˆ°æ–° namespace ä¸­çš„è¿›ç¨‹
```

**ç¤ºä¾‹å¯¹æ¯”ï¼š**
```bash
# ä¸»æœºç³»ç»Ÿ
$ ps aux | head -3
USER    PID   %CPU %MEM    VSZ   RSS TTY   STAT START   TIME COMMAND
root      1   0.0  0.1  77616  8964 ?     Ss   Jul28   0:01 /sbin/init
root      2   0.0  0.0      0     0 ?     S    Jul28   0:00 [kthreadd]

# å®¹å™¨å†…ï¼ˆç‹¬ç«‹çš„ PID namespaceï¼‰
$ ps aux | head -3
USER    PID   %CPU %MEM    VSZ   RSS TTY   STAT START   TIME COMMAND
root      1   0.0  0.1  20312  3204 ?     Ss   10:30   0:00 /bin/bash
root     15   0.0  0.1  34400  2896 ?     R+   10:31   0:00 ps aux
```

##### 2. **Network Namespace (ç½‘ç»œéš”ç¦»)** - `Linux 2.6.24 (2008å¹´)`
- **åŠŸèƒ½**: éš”ç¦»ç½‘ç»œåè®®æ ˆ
- **åŒ…å«**: ç½‘ç»œæ¥å£ã€è·¯ç”±è¡¨ã€é˜²ç«å¢™è§„åˆ™ã€å¥—æ¥å­—ç­‰
- **åº”ç”¨**: æ¯ä¸ªå®¹å™¨æœ‰ç‹¬ç«‹çš„ç½‘ç»œæ ˆ
- **å†å²**: ä¸ PID namespace åŒæœŸå¼•å…¥ï¼Œä½¿å®¹å™¨ç½‘ç»œéš”ç¦»æˆä¸ºå¯èƒ½

```bash
# åˆ›å»ºç½‘ç»œ namespace
ip netns add test-ns

# æŸ¥çœ‹ namespace åˆ—è¡¨
ip netns list

# åœ¨æŒ‡å®š namespace ä¸­æ‰§è¡Œå‘½ä»¤
ip netns exec test-ns ip addr show

# åˆ›å»º veth pair è¿æ¥ä¸åŒ namespace
ip link add veth0 type veth peer name veth1
ip link set veth1 netns test-ns
```

**ç½‘ç»œéš”ç¦»ç¤ºä¾‹ï¼š**
```bash
# ä¸»æœºç½‘ç»œ
$ ip addr show
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast

# æ–°çš„ç½‘ç»œ namespaceï¼ˆåˆå§‹çŠ¶æ€åªæœ‰ lo æ¥å£ï¼‰
$ ip netns exec test-ns ip addr show
1: lo: <LOOPBACK> mtu 65536 qdisc noop state DOWN
```

##### 3. **Mount Namespace (æ–‡ä»¶ç³»ç»Ÿéš”ç¦»)** - `Linux 2.4.19 (2002å¹´)`
- **åŠŸèƒ½**: éš”ç¦»æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ç‚¹
- **ç‰¹ç‚¹**: æ¯ä¸ª namespace æœ‰ç‹¬ç«‹çš„æ–‡ä»¶ç³»ç»Ÿè§†å›¾
- **åº”ç”¨**: å®¹å™¨æœ‰ç‹¬ç«‹çš„æ ¹æ–‡ä»¶ç³»ç»Ÿ
- **å†å²**: æœ€æ—©çš„ namespace å®ç°ï¼Œæœ€åˆå«åš "mount namespace"

```bash
# åˆ›å»º mount namespace
unshare --mount /bin/bash

# åœ¨æ–° namespace ä¸­çš„æŒ‚è½½æ“ä½œä¸å½±å“ä¸»æœº
mount -t tmpfs tmpfs /tmp
```

##### 4. **UTS Namespace (UNIX Time-sharing System - ä¸»æœºåéš”ç¦»)** - `Linux 2.6.19 (2006å¹´)`
- **åŠŸèƒ½**: éš”ç¦»ä¸»æœºåå’ŒåŸŸå
- **åº”ç”¨**: å®¹å™¨å¯ä»¥æœ‰ç‹¬ç«‹çš„ä¸»æœºå
- **å…¨ç§°**: UTS = UNIX Time-sharing Systemï¼Œå†å²ä¸ŠæŒ‡ä»£ç³»ç»Ÿæ ‡è¯†ä¿¡æ¯
- **å†å²**: ä¸ºå®¹å™¨æä¾›ç‹¬ç«‹çš„ç³»ç»Ÿæ ‡è¯†ï¼Œå¢å¼ºéš”ç¦»æ€§

```bash
# åˆ›å»º UTS namespace
unshare --uts /bin/bash

# ä¿®æ”¹ä¸»æœºåï¼ˆåªåœ¨å½“å‰ namespace ç”Ÿæ•ˆï¼‰
hostname container-host
```

##### 5. **IPC Namespace (Inter-Process Communication - è¿›ç¨‹é—´é€šä¿¡éš”ç¦»)** - `Linux 2.6.19 (2006å¹´)`
- **åŠŸèƒ½**: éš”ç¦» System V IPC å’Œ POSIX æ¶ˆæ¯é˜Ÿåˆ—
- **åŒ…å«**: æ¶ˆæ¯é˜Ÿåˆ—ã€ä¿¡å·é‡ã€å…±äº«å†…å­˜
- **å…¨ç§°**: IPC = Inter-Process Communicationï¼Œè¿›ç¨‹é—´é€šä¿¡æœºåˆ¶
- **å†å²**: ä¸ UTS namespace åŒæœŸå¼•å…¥ï¼Œå®Œå–„è¿›ç¨‹é—´éš”ç¦»

```bash
# åˆ›å»º IPC namespace
unshare --ipc /bin/bash

# æŸ¥çœ‹ IPC èµ„æº
ipcs -a
```

##### 6. **User Namespace (ç”¨æˆ·éš”ç¦»)** - `Linux 3.8 (2013å¹´)`
- **åŠŸèƒ½**: éš”ç¦»ç”¨æˆ·å’Œç»„ ID
- **ç‰¹ç‚¹**: namespace å†…çš„ root ä¸ç­‰äºä¸»æœº root
- **å®‰å…¨**: æä¾›æ›´å¥½çš„æƒé™éš”ç¦»
- **å†å²**: è¾ƒæ™šå¼•å…¥çš„é‡è¦å®‰å…¨ç‰¹æ€§ï¼Œä½¿æ— ç‰¹æƒå®¹å™¨æˆä¸ºå¯èƒ½

```bash
# åˆ›å»º user namespace
unshare --user --map-root-user /bin/bash

# æŸ¥çœ‹ç”¨æˆ·æ˜ å°„
cat /proc/self/uid_map
cat /proc/self/gid_map
```

##### 7. **Cgroup Namespace (æ§åˆ¶ç»„éš”ç¦»)** - `Linux 4.6 (2016å¹´)`
- **åŠŸèƒ½**: éš”ç¦» cgroup æ ¹ç›®å½•è§†å›¾
- **åº”ç”¨**: å®¹å™¨çœ‹ä¸åˆ°ä¸»æœºçš„ cgroup å±‚æ¬¡ç»“æ„
- **é‡è¦è¯´æ˜**: è¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ namespaceï¼Œå®ƒéš”ç¦»çš„æ˜¯ cgroup æ–‡ä»¶ç³»ç»Ÿçš„è§†å›¾ï¼Œè€Œä¸æ˜¯ cgroup çš„åŠŸèƒ½æœ¬èº«
- **å†å²**: è¾ƒæ–°çš„å®‰å…¨å¢å¼ºç‰¹æ€§ï¼Œé˜²æ­¢å®¹å™¨è·å–ä¸»æœº cgroup ä¿¡æ¯

#### ğŸ” æ·±å…¥ç†è§£ Cgroup Namespace

**Cgroup Namespace** æ˜¯ä¸€ä¸ªå®¹æ˜“æ··æ·†çš„æ¦‚å¿µï¼Œè®©æˆ‘ä»¬è¯¦ç»†è§£é‡Šï¼š

##### ğŸ“‹ Cgroup Namespace vs Cgroup åŠŸèƒ½

**å…³é”®åŒºåˆ«:**
- **Cgroup åŠŸèƒ½**: èµ„æºé™åˆ¶å’Œæ§åˆ¶ï¼ˆCPUã€å†…å­˜ã€IOç­‰ï¼‰
- **Cgroup Namespace**: éš”ç¦» `/proc/*/cgroup` å’Œ `/sys/fs/cgroup` çš„è§†å›¾

```bash
# æ²¡æœ‰ Cgroup Namespace æ—¶ï¼Œå®¹å™¨å†…å¯ä»¥çœ‹åˆ°ä¸»æœºçš„å®Œæ•´ cgroup å±‚æ¬¡
å®¹å™¨å†…æ‰§è¡Œ: cat /proc/self/cgroup
è¾“å‡º: 12:memory:/docker/a1b2c3d4e5f6.../
     11:cpu:/docker/a1b2c3d4e5f6.../
     # å¯ä»¥çœ‹åˆ°å®Œæ•´çš„ä¸»æœº cgroup è·¯å¾„

# æœ‰ Cgroup Namespace æ—¶ï¼Œå®¹å™¨åªçœ‹åˆ°ç›¸å¯¹è·¯å¾„
å®¹å™¨å†…æ‰§è¡Œ: cat /proc/self/cgroup  
è¾“å‡º: 12:memory:/
     11:cpu:/
     # çœ‹èµ·æ¥åƒæ˜¯ cgroup æ ¹ç›®å½•
```

##### ğŸ› ï¸ å®é™…æ“ä½œæ¼”ç¤º

**åˆ›å»º Cgroup Namespace:**
```bash
# 1. åˆ›å»ºå¸¦æœ‰ cgroup namespace çš„ç¯å¢ƒ
unshare --cgroup /bin/bash

# 2. æŸ¥çœ‹ cgroup è§†å›¾å˜åŒ–
echo "=== ä¸»æœºè§†å›¾ ==="
cat /proc/1/cgroup | head -3

echo "=== Namespace å†…è§†å›¾ ==="  
cat /proc/self/cgroup | head -3

# 3. æŸ¥çœ‹ /sys/fs/cgroup çš„å˜åŒ–
ls -la /sys/fs/cgroup/
```

**å¯¹æ¯”æ•ˆæœ:**
```bash
# ä¸»æœºä¸Šçš„å®Œæ•´ cgroup è·¯å¾„
ä¸»æœº: cat /proc/self/cgroup
12:memory:/user.slice/user-1000.slice/session-1.scope
11:cpu,cpuacct:/user.slice/user-1000.slice/session-1.scope

# Cgroup Namespace å†…çš„ç›¸å¯¹è·¯å¾„  
å®¹å™¨: cat /proc/self/cgroup
12:memory:/
11:cpu,cpuacct:/
```

##### ğŸ¯ ä¸ºä»€ä¹ˆéœ€è¦ Cgroup Namespaceï¼Ÿ

**1. å®‰å…¨éš”ç¦»**
```bash
# é˜²æ­¢å®¹å™¨è·å–ä¸»æœº cgroup ä¿¡æ¯
# æ²¡æœ‰ cgroup namespace æ—¶ï¼Œæ¶æ„å®¹å™¨å¯èƒ½ï¼š
cat /proc/1/cgroup  # çœ‹åˆ°ä¸»æœºè¿›ç¨‹çš„ cgroup è·¯å¾„
ls /sys/fs/cgroup/memory/docker/  # çœ‹åˆ°æ‰€æœ‰å®¹å™¨çš„ cgroup

# æœ‰ cgroup namespace åï¼š
cat /proc/1/cgroup  # åªçœ‹åˆ°ç›¸å¯¹è·¯å¾„ "/"
ls /sys/fs/cgroup/memory/  # çœ‹èµ·æ¥åƒæ˜¯æ ¹ cgroup
```

**2. ä¿¡æ¯æ³„éœ²é˜²æŠ¤**
```bash
# ä¸»æœºçš„ cgroup è·¯å¾„å¯èƒ½æ³„éœ²æ•æ„Ÿä¿¡æ¯
/sys/fs/cgroup/memory/docker/a1b2c3d4e5f6789.../
# å®¹å™¨IDã€ä¸»æœºæ¶æ„ç­‰ä¿¡æ¯

# Cgroup namespace éšè—äº†è¿™äº›ä¿¡æ¯
/  # åªçœ‹åˆ°æ ¹è·¯å¾„
```

**3. å®¹å™¨å†…ç¨‹åºå…¼å®¹æ€§**
```bash
# æŸäº›ç¨‹åºä¼šè¯»å– /proc/self/cgroup æ¥åˆ¤æ–­è¿è¡Œç¯å¢ƒ
# æ²¡æœ‰ cgroup namespace æ—¶å¯èƒ½çœ‹åˆ°å¤æ‚çš„è·¯å¾„è€Œå‡ºé”™
# æœ‰äº† cgroup namespace åçœ‹åˆ°çš„æ˜¯æ ‡å‡†çš„æ ¹è·¯å¾„
```

##### ğŸ”¬ æ·±åº¦æŠ€æœ¯åˆ†æ

**æ–‡ä»¶ç³»ç»Ÿè§†å›¾å˜åŒ–:**
```bash
# ä¸»æœºä¸Šçš„å®é™… cgroup å±‚æ¬¡ç»“æ„
/sys/fs/cgroup/
â”œâ”€â”€ memory/
â”‚   â”œâ”€â”€ docker/
â”‚   â”‚   â”œâ”€â”€ container1.../
â”‚   â”‚   â”‚   â”œâ”€â”€ memory.limit_in_bytes
â”‚   â”‚   â”‚   â””â”€â”€ tasks
â”‚   â”‚   â””â”€â”€ container2.../
â”‚   â””â”€â”€ user.slice/
â””â”€â”€ cpu/
    â””â”€â”€ docker/
        â””â”€â”€ container1.../

# Cgroup Namespace å†…çœ‹åˆ°çš„è™šæ‹Ÿå±‚æ¬¡ç»“æ„
/sys/fs/cgroup/
â”œâ”€â”€ memory/
â”‚   â”œâ”€â”€ memory.limit_in_bytes  # æŒ‡å‘å®é™…çš„å®¹å™¨ cgroup
â”‚   â””â”€â”€ tasks
â””â”€â”€ cpu/
    â”œâ”€â”€ cpu.cfs_quota_us
    â””â”€â”€ tasks
```

**å†…æ ¸å®ç°åŸç†:**
```bash
# å†…æ ¸åœ¨ Cgroup Namespace å†…é‡æ–°æ˜ å°„è·¯å¾„
å®é™…è·¯å¾„: /sys/fs/cgroup/memory/docker/a1b2c3d4.../memory.limit_in_bytes
è™šæ‹Ÿè·¯å¾„: /sys/fs/cgroup/memory/memory.limit_in_bytes

# /proc/*/cgroup æ–‡ä»¶å†…å®¹ä¹Ÿè¢«é‡å†™
å®é™…å†…å®¹: 12:memory:/docker/a1b2c3d4e5f6.../
è™šæ‹Ÿå†…å®¹: 12:memory:/
```

##### ğŸ§ª å®è·µéªŒè¯

**éªŒè¯è„šæœ¬:**
```bash
#!/bin/bash
echo "=== éªŒè¯ Cgroup Namespace æ•ˆæœ ==="

# 1. åœ¨ä¸»æœºä¸ŠæŸ¥çœ‹å½“å‰è¿›ç¨‹çš„ cgroup
echo "ä¸»æœº cgroup è·¯å¾„:"
cat /proc/self/cgroup | head -3

echo ""
echo "ä¸»æœº cgroup æ–‡ä»¶ç³»ç»Ÿ:"
ls -la /sys/fs/cgroup/ | head -5

# 2. åˆ›å»º cgroup namespace å¹¶å¯¹æ¯”
echo ""
echo "åˆ›å»º Cgroup Namespace..."
unshare --cgroup /bin/bash -c '
echo "Namespace å†… cgroup è·¯å¾„:"
cat /proc/self/cgroup | head -3

echo ""
echo "Namespace å†… cgroup æ–‡ä»¶ç³»ç»Ÿ:"
ls -la /sys/fs/cgroup/ | head -5

echo ""
echo "éªŒè¯è·¯å¾„æ˜ å°„:"
echo "å½“å‰è¿›ç¨‹çš„å†…å­˜é™åˆ¶æ–‡ä»¶:"
cat /sys/fs/cgroup/memory/memory.limit_in_bytes 2>/dev/null || echo "æ–‡ä»¶ä¸å­˜åœ¨æˆ–æ— æƒé™"
'
```

##### âš ï¸ æ³¨æ„äº‹é¡¹å’Œé™åˆ¶

**1. åŠŸèƒ½é™åˆ¶**
```bash
# Cgroup Namespace åªéš”ç¦»è§†å›¾ï¼Œä¸éš”ç¦»åŠŸèƒ½
# å®¹å™¨å†…çš„è¿›ç¨‹ä»ç„¶å—åˆ°ä¸»æœºè®¾ç½®çš„ cgroup é™åˆ¶

# å®¹å™¨å†…æ— æ³•çœŸæ­£ä¿®æ”¹ cgroup è®¾ç½®
echo "1G" > /sys/fs/cgroup/memory/memory.limit_in_bytes  # é€šå¸¸ä¼šå¤±è´¥
```

**2. å…¼å®¹æ€§é—®é¢˜**
```bash
# æŸäº›ç›‘æ§å·¥å…·å¯èƒ½ä¸ç†è§£ cgroup namespace
# éœ€è¦æ›´æ–°å·¥å…·ä»¥æ­£ç¡®å¤„ç†è™šæ‹ŸåŒ–çš„ cgroup è·¯å¾„
```

**3. è°ƒè¯•å›°éš¾**
```bash
# åœ¨ cgroup namespace å†…è°ƒè¯• cgroup é—®é¢˜æ›´å›°éš¾
# éœ€è¦ä»ä¸»æœºè§’åº¦æŸ¥çœ‹çœŸå®çš„ cgroup è·¯å¾„
```

##### ğŸ³ åœ¨å®¹å™¨æŠ€æœ¯ä¸­çš„åº”ç”¨

**Docker ä¸­çš„ä½¿ç”¨:**
```bash
# Docker å¯ä»¥é€‰æ‹©æ˜¯å¦å¯ç”¨ cgroup namespace
docker run --cgroupns=private nginx  # å¯ç”¨ cgroup namespace
docker run --cgroupns=host nginx     # ä½¿ç”¨ä¸»æœº cgroup namespace

# æŸ¥çœ‹æ•ˆæœ
docker exec container cat /proc/self/cgroup
```

**Kubernetes ä¸­çš„åº”ç”¨:**
```yaml
# Kubernetes 1.25+ æ”¯æŒ cgroup namespace
apiVersion: v1
kind: Pod
metadata:
  name: test-pod
spec:
  hostPID: false  # ç¡®ä¿ PID éš”ç¦»
  containers:
  - name: app
    image: nginx
    # cgroup namespace é€šå¸¸è‡ªåŠ¨å¯ç”¨
```

##### ğŸ“Š Cgroup Namespace vs å…¶ä»– Namespace

| Namespaceç±»å‹ | éš”ç¦»å¯¹è±¡ | å½±å“èŒƒå›´ | å®‰å…¨æ”¶ç›Š |
|---------------|----------|----------|----------|
| **PID** | è¿›ç¨‹IDç©ºé—´ | è¿›ç¨‹å¯è§æ€§ | é«˜ |
| **Network** | ç½‘ç»œåè®®æ ˆ | ç½‘ç»œè®¿é—® | é«˜ |
| **Mount** | æ–‡ä»¶ç³»ç»Ÿ | æ–‡ä»¶è®¿é—® | é«˜ |
| **Cgroup** | Cgroupè§†å›¾ | ç³»ç»Ÿä¿¡æ¯ | ä¸­ç­‰ |

**æ€»ç»“**: Cgroup Namespace æ˜¯ä¸€ä¸ª"å…ƒéš”ç¦»"æœºåˆ¶ï¼Œå®ƒéš”ç¦»çš„æ˜¯ cgroup ç®¡ç†ç³»ç»Ÿæœ¬èº«çš„è§†å›¾ï¼Œè€Œä¸æ˜¯è¢«ç®¡ç†çš„èµ„æºã€‚å®ƒæä¾›äº†é¢å¤–çš„å®‰å…¨å±‚ï¼Œé˜²æ­¢å®¹å™¨è·å–ä¸»æœºçš„ cgroup ç»“æ„ä¿¡æ¯ã€‚

##### 8. **Time Namespace (æ—¶é—´éš”ç¦»)** - `Linux 5.6 (2020å¹´)`
- **åŠŸèƒ½**: éš”ç¦»ç³»ç»Ÿæ—¶é—´
- **ç‰¹ç‚¹**: è¾ƒæ–°çš„ç‰¹æ€§ï¼Œæ”¯æŒç‹¬ç«‹çš„æ—¶é’Ÿè®¾ç½®
- **åº”ç”¨**: å…è®¸å®¹å™¨æœ‰ç‹¬ç«‹çš„æ—¶é—´è§†å›¾ï¼Œç”¨äºæµ‹è¯•å’Œæ¨¡æ‹Ÿ
- **å†å²**: æœ€æ–°å¼•å…¥çš„ namespaceï¼Œä¸»è¦ç”¨äºç‰¹æ®Šæµ‹è¯•åœºæ™¯

#### ğŸ“Š Namespace å‘å±•æ—¶é—´çº¿

```
2002  â”Œâ”€ Mount Namespace (Linux 2.4.19)
      â”‚  â””â”€ æœ€æ—©çš„ namespace å®ç°
      â”‚
2006  â”œâ”€ UTS + IPC Namespace (Linux 2.6.19)  
      â”‚  â””â”€ ä¸»æœºåå’Œè¿›ç¨‹é—´é€šä¿¡éš”ç¦»
      â”‚
2008  â”œâ”€ PID + Network Namespace (Linux 2.6.24)
      â”‚  â””â”€ è¿›ç¨‹å’Œç½‘ç»œéš”ç¦»ï¼Œå®¹å™¨æŠ€æœ¯å…³é”®é‡Œç¨‹ç¢‘
      â”‚
2013  â”œâ”€ User Namespace (Linux 3.8)
      â”‚  â””â”€ ç”¨æˆ·æƒé™éš”ç¦»ï¼Œé‡å¤§å®‰å…¨å¢å¼º
      â”‚
2016  â”œâ”€ Cgroup Namespace (Linux 4.6)
      â”‚  â””â”€ Cgroup è§†å›¾éš”ç¦»
      â”‚
2020  â””â”€ Time Namespace (Linux 5.6)
         â””â”€ æ—¶é—´éš”ç¦»ï¼Œæœ€æ–°ç‰¹æ€§
```

#### ğŸ¯ å„ç‰ˆæœ¬çš„é‡è¦æ„ä¹‰

**æ—©æœŸé˜¶æ®µ (2002-2008):**
- **Mount Namespace**: å¥ å®šäº†èµ„æºéš”ç¦»çš„åŸºç¡€
- **UTS/IPC Namespace**: å®Œå–„äº†åŸºæœ¬çš„è¿›ç¨‹éš”ç¦»
- **PID/Network Namespace**: ä½¿çœŸæ­£çš„å®¹å™¨æŠ€æœ¯æˆä¸ºå¯èƒ½

**æˆç†Ÿé˜¶æ®µ (2008-2013):**
- åŸºç¡€çš„å®¹å™¨éš”ç¦»åŠŸèƒ½å·²ç»å®Œå¤‡
- Docker (2013å¹´) æ­£æ˜¯åŸºäºè¿™äº› namespace æ„å»º

**å®‰å…¨å¢å¼ºé˜¶æ®µ (2013-2020):**
- **User Namespace**: è§£å†³äº†å®¹å™¨å®‰å…¨çš„æ ¸å¿ƒé—®é¢˜
- **Cgroup Namespace**: è¿›ä¸€æ­¥å¢å¼ºäº†ä¿¡æ¯éš”ç¦»
- **Time Namespace**: ä¸ºç‰¹æ®Šåº”ç”¨åœºæ™¯æä¾›æ”¯æŒ

#### ğŸ› ï¸ Namespace æ“ä½œå‘½ä»¤

##### åŸºæœ¬å‘½ä»¤å·¥å…·
```bash
# unshare - åˆ›å»ºæ–°çš„ namespace
unshare [options] [program [arguments]]

# nsenter - è¿›å…¥å·²å­˜åœ¨çš„ namespace  
nsenter [options] [program [arguments]]

# ip netns - ç½‘ç»œ namespace ä¸“ç”¨å·¥å…·
ip netns {add|del|list|exec} [arguments]
```

##### å¸¸ç”¨æ“ä½œç¤ºä¾‹
```bash
# 1. åˆ›å»ºåŒ…å«å¤šç§ namespace çš„ç¯å¢ƒ
unshare --pid --net --mount --uts --ipc --fork /bin/bash

# 2. æŸ¥çœ‹è¿›ç¨‹çš„ namespace ä¿¡æ¯
ls -la /proc/$PID/ns/

# 3. è¿›å…¥æŒ‡å®šè¿›ç¨‹çš„ namespace
nsenter --target $PID --pid --net --mount /bin/bash

# 4. åˆ›å»ºæŒä¹…åŒ–çš„ç½‘ç»œ namespace
ip netns add my-namespace
ip netns exec my-namespace /bin/bash
```

#### ğŸ” Namespace åœ¨å®¹å™¨ä¸­çš„åº”ç”¨

##### Docker å®¹å™¨çš„ Namespace ä½¿ç”¨
```bash
# æŸ¥çœ‹ Docker å®¹å™¨ä½¿ç”¨çš„ namespace
docker run -d --name test-container nginx
docker inspect test-container | grep -i namespace

# è¿›å…¥å®¹å™¨çš„ namespace
docker exec -it test-container /bin/bash

# ä»ä¸»æœºè¿›å…¥å®¹å™¨çš„ namespace
PID=$(docker inspect -f '{{.State.Pid}}' test-container)
nsenter --target $PID --pid --net --mount /bin/bash
```

##### Kubernetes Pod çš„ Namespace å…±äº«
```yaml
# Pod ä¸­çš„å®¹å™¨å…±äº«æŸäº› namespace
apiVersion: v1
kind: Pod
metadata:
  name: multi-container-pod
spec:
  containers:
  - name: container1
    image: nginx
  - name: container2  
    image: busybox
    command: ['sleep', '3600']
  # ä¸¤ä¸ªå®¹å™¨å…±äº«ï¼šNetworkã€IPCã€UTS namespace
  # ç‹¬ç«‹ï¼šPIDã€Mount namespaceï¼ˆå¯é…ç½®ï¼‰
```

#### ğŸ”§ å®è·µç»ƒä¹ ï¼šåˆ›å»ºå®Œæ•´çš„å®¹å™¨ç¯å¢ƒ

##### 1. æ‰‹åŠ¨åˆ›å»ºç±»ä¼¼å®¹å™¨çš„éš”ç¦»ç¯å¢ƒ
```bash
#!/bin/bash
# åˆ›å»ºå®Œæ•´çš„ namespace éš”ç¦»ç¯å¢ƒ

# 1. åˆ›å»ºæ‰€æœ‰ç±»å‹çš„ namespace
unshare --pid --net --mount --uts --ipc --user --map-root-user --fork /bin/bash -c '

# 2. è®¾ç½®ä¸»æœºå
hostname my-container

# 3. é‡æ–°æŒ‚è½½ /procï¼ˆæ˜¾ç¤ºæ–°çš„ PID namespaceï¼‰
mount -t proc proc /proc

# 4. åˆ›å»ºç½‘ç»œæ¥å£
ip link add veth0 type veth peer name veth1

# 5. é…ç½®ç½‘ç»œ
ip addr add 192.168.100.1/24 dev veth0
ip link set veth0 up
ip link set lo up

# 6. å¯åŠ¨ shell
exec /bin/bash
'
```

##### 2. éªŒè¯éš”ç¦»æ•ˆæœ
```bash
# åœ¨æ–°ç¯å¢ƒä¸­éªŒè¯å„ç§éš”ç¦»
echo "=== è¿›ç¨‹éš”ç¦» ==="
ps aux  # åº”è¯¥åªçœ‹åˆ°å°‘é‡è¿›ç¨‹

echo "=== ç½‘ç»œéš”ç¦» ==="  
ip addr show  # åº”è¯¥åªçœ‹åˆ°é…ç½®çš„æ¥å£

echo "=== ä¸»æœºåéš”ç¦» ==="
hostname  # åº”è¯¥æ˜¾ç¤º my-container

echo "=== ç”¨æˆ·éš”ç¦» ==="
id  # åº”è¯¥æ˜¾ç¤º uid=0(root)ï¼Œä½†å®é™…æ˜¯æ˜ å°„çš„ç”¨æˆ·
```

#### ğŸ“Š Namespace çš„å±‚æ¬¡ç»“æ„

```
Host Namespace (æœ€é¡¶å±‚)
â”œâ”€â”€ PID 1 (init)
â”œâ”€â”€ Container Namespace A
â”‚   â”œâ”€â”€ PID 1 (å®¹å™¨è¿›ç¨‹)
â”‚   â”œâ”€â”€ PID 2 (åº”ç”¨è¿›ç¨‹)
â”‚   â””â”€â”€ ç‹¬ç«‹çš„ç½‘ç»œæ ˆ
â””â”€â”€ Container Namespace B  
    â”œâ”€â”€ PID 1 (å®¹å™¨è¿›ç¨‹)
    â”œâ”€â”€ PID 2 (åº”ç”¨è¿›ç¨‹)
    â””â”€â”€ ç‹¬ç«‹çš„ç½‘ç»œæ ˆ
```

#### ğŸš¨ æ³¨æ„äº‹é¡¹å’Œæœ€ä½³å®è·µ

##### 1. **å®‰å…¨è€ƒè™‘**
```bash
# User namespace æ˜ å°„è¦è°¨æ…
echo "0 1000 1" > /proc/self/uid_map  # å°† root æ˜ å°„åˆ°æ™®é€šç”¨æˆ·

# é¿å…ç‰¹æƒå®¹å™¨å…±äº«ä¸»æœº namespace
docker run --privileged  # å±é™©ï¼šç»•è¿‡éš”ç¦»
```

##### 2. **æ€§èƒ½å½±å“**
- namespace åˆ‡æ¢æœ‰è½»å¾®æ€§èƒ½å¼€é”€
- å¤§é‡ namespace ä¼šå¢åŠ å†…å­˜ä½¿ç”¨
- ç½‘ç»œ namespace è¿‡å¤šå¯èƒ½å½±å“è·¯ç”±æ€§èƒ½

##### 3. **è°ƒè¯•æŠ€å·§**
```bash
# æŸ¥çœ‹è¿›ç¨‹çš„æ‰€æœ‰ namespace
lsns -p $PID

# æ¯”è¾ƒä¸¤ä¸ªè¿›ç¨‹çš„ namespace
lsns -p $PID1 > ns1.txt
lsns -p $PID2 > ns2.txt
diff ns1.txt ns2.txt
```

#### ğŸ”— ä¸å…¶ä»–éš”ç¦»æŠ€æœ¯çš„å…³ç³»

| æŠ€æœ¯ | éš”ç¦»çº§åˆ« | å¼€é”€ | å®‰å…¨æ€§ |
|------|----------|------|--------|
| **Namespace** | è¿›ç¨‹çº§ | ä½ | ä¸­ç­‰ |
| **è™šæ‹Ÿæœº** | ç³»ç»Ÿçº§ | é«˜ | é«˜ |
| **Chroot** | æ–‡ä»¶ç³»ç»Ÿ | å¾ˆä½ | ä½ |
| **Cgroup** | èµ„æºé™åˆ¶ | ä½ | ä¸­ç­‰ |

#### ğŸ†š Namespace vs Cgroup è¯¦ç»†å¯¹æ¯”

è™½ç„¶ Namespace å’Œ Cgroup éƒ½æ˜¯å®¹å™¨æŠ€æœ¯çš„æ ¸å¿ƒç»„ä»¶ï¼Œä½†å®ƒä»¬è§£å†³çš„æ˜¯å®Œå…¨ä¸åŒçš„é—®é¢˜ï¼š

##### ğŸ“‹ æ ¸å¿ƒåŠŸèƒ½å¯¹æ¯”

| ç‰¹æ€§ | Namespace | Cgroup (Control Groups) |
|------|-----------|-------------------------|
| **ä¸»è¦ä½œç”¨** | **èµ„æºéš”ç¦»** (çœ‹ä¸åˆ°) | **èµ„æºé™åˆ¶** (ç”¨ä¸å®Œ) |
| **è§£å†³é—®é¢˜** | "è¿›ç¨‹èƒ½çœ‹åˆ°ä»€ä¹ˆèµ„æº" | "è¿›ç¨‹èƒ½ä½¿ç”¨å¤šå°‘èµ„æº" |
| **æŠ€æœ¯åŸç†** | è™šæ‹ŸåŒ–èµ„æºè§†å›¾ | é™åˆ¶å’Œæ§åˆ¶èµ„æºä½¿ç”¨ |
| **å…¸å‹åº”ç”¨** | è¿›ç¨‹éš”ç¦»ã€ç½‘ç»œéš”ç¦» | CPUé™åˆ¶ã€å†…å­˜é™åˆ¶ |

##### ğŸ” å…·ä½“åŠŸèƒ½å·®å¼‚

**Namespaceï¼ˆèµ„æºéš”ç¦»ï¼‰:**
```bash
# Namespace è®©è¿›ç¨‹"çœ‹ä¸åˆ°"å…¶ä»–èµ„æº
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Container A         â”‚  â”‚     Container B         â”‚
â”‚                         â”‚  â”‚                         â”‚
â”‚ åªèƒ½çœ‹åˆ°è‡ªå·±çš„:          â”‚  â”‚ åªèƒ½çœ‹åˆ°è‡ªå·±çš„:          â”‚
â”‚ â€¢ è¿›ç¨‹åˆ—è¡¨              â”‚  â”‚ â€¢ è¿›ç¨‹åˆ—è¡¨              â”‚
â”‚ â€¢ ç½‘ç»œæ¥å£              â”‚  â”‚ â€¢ ç½‘ç»œæ¥å£              â”‚
â”‚ â€¢ æ–‡ä»¶ç³»ç»Ÿ              â”‚  â”‚ â€¢ æ–‡ä»¶ç³»ç»Ÿ              â”‚
â”‚ â€¢ ä¸»æœºå                â”‚  â”‚ â€¢ ä¸»æœºå                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

# éªŒè¯ PID éš”ç¦»
ä¸»æœº: ps aux  # çœ‹åˆ°æ‰€æœ‰è¿›ç¨‹
å®¹å™¨: ps aux  # åªçœ‹åˆ°å®¹å™¨å†…è¿›ç¨‹
```

**Cgroupï¼ˆèµ„æºé™åˆ¶ï¼‰:**
```bash
# Cgroup é™åˆ¶è¿›ç¨‹"èƒ½ç”¨å¤šå°‘"èµ„æº
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Host                     â”‚
â”‚  æ€»èµ„æº: CPU 8æ ¸, å†…å­˜ 16GB            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Container A   â”‚     Container B       â”‚
â”‚                 â”‚                       â”‚
â”‚   é™åˆ¶ä¸º:       â”‚     é™åˆ¶ä¸º:           â”‚
â”‚   â€¢ CPU: 2æ ¸    â”‚     â€¢ CPU: 1æ ¸        â”‚
â”‚   â€¢ å†…å­˜: 4GB   â”‚     â€¢ å†…å­˜: 2GB       â”‚
â”‚   â€¢ ç£ç›˜IOé™åˆ¶  â”‚     â€¢ ç½‘ç»œå¸¦å®½é™åˆ¶    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

##### ğŸ› ï¸ å®é™…æ“ä½œå¯¹æ¯”

**Namespace æ“ä½œç¤ºä¾‹:**
```bash
# åˆ›å»ºç½‘ç»œéš”ç¦»
ip netns add container-a
ip netns exec container-a ip addr show  # ç‹¬ç«‹çš„ç½‘ç»œè§†å›¾

# åˆ›å»º PID éš”ç¦»  
unshare --pid --fork --mount-proc /bin/bash
ps aux  # çœ‹åˆ°çš„æ˜¯éš”ç¦»åçš„è¿›ç¨‹åˆ—è¡¨

# åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿéš”ç¦»
unshare --mount /bin/bash
mount -t tmpfs tmpfs /tmp  # åªå½±å“å½“å‰ namespace
```

**Cgroup æ“ä½œç¤ºä¾‹:**
```bash
# åˆ›å»º CPU é™åˆ¶
mkdir /sys/fs/cgroup/cpu/my-container
echo "50000" > /sys/fs/cgroup/cpu/my-container/cpu.cfs_quota_us  # é™åˆ¶ä¸º0.5æ ¸
echo $$ > /sys/fs/cgroup/cpu/my-container/tasks

# åˆ›å»ºå†…å­˜é™åˆ¶
mkdir /sys/fs/cgroup/memory/my-container  
echo "512M" > /sys/fs/cgroup/memory/my-container/memory.limit_in_bytes
echo $$ > /sys/fs/cgroup/memory/my-container/tasks

# éªŒè¯é™åˆ¶ç”Ÿæ•ˆ
cat /proc/self/cgroup  # æŸ¥çœ‹å½“å‰è¿›ç¨‹çš„ cgroup
```

##### ğŸ“Š èµ„æºç®¡ç†æ–¹å¼å¯¹æ¯”

**Namespaceï¼ˆè§†å›¾éš”ç¦»ï¼‰:**
```
è¿›ç¨‹A çœ‹åˆ°çš„ç³»ç»Ÿèµ„æº:
â”œâ”€â”€ ç½‘ç»œæ¥å£: eth0 (10.1.1.100)
â”œâ”€â”€ è¿›ç¨‹åˆ—è¡¨: PID 1, 2, 3
â””â”€â”€ æ–‡ä»¶ç³»ç»Ÿ: /app, /tmp, /var

è¿›ç¨‹B çœ‹åˆ°çš„ç³»ç»Ÿèµ„æº:  
â”œâ”€â”€ ç½‘ç»œæ¥å£: eth0 (10.1.2.100)  # ä¸åŒçš„IP
â”œâ”€â”€ è¿›ç¨‹åˆ—è¡¨: PID 1, 2, 3        # ä¸åŒçš„è¿›ç¨‹
â””â”€â”€ æ–‡ä»¶ç³»ç»Ÿ: /web, /tmp, /var    # ä¸åŒçš„æŒ‚è½½ç‚¹

å®é™…ç‰©ç†èµ„æºæ˜¯å…±äº«çš„ï¼Œä½†é€»è¾‘è§†å›¾æ˜¯éš”ç¦»çš„
```

**Cgroupï¼ˆé…é¢é™åˆ¶ï¼‰:**
```
ç‰©ç†æœåŠ¡å™¨èµ„æº:
â”œâ”€â”€ CPU: 8æ ¸å¿ƒ 100%
â”œâ”€â”€ å†…å­˜: 16GB  
â””â”€â”€ ç£ç›˜IO: 1000 IOPS

åˆ†é…ç»™å®¹å™¨çš„é…é¢:
â”œâ”€â”€ å®¹å™¨A: CPU 25%(2æ ¸), å†…å­˜ 4GB, IO 300 IOPS
â”œâ”€â”€ å®¹å™¨B: CPU 12.5%(1æ ¸), å†…å­˜ 2GB, IO 200 IOPS  
â””â”€â”€ å‰©ä½™: CPU 62.5%(5æ ¸), å†…å­˜ 10GB, IO 500 IOPS
```

##### ğŸ¯ åº”ç”¨åœºæ™¯å¯¹æ¯”

**ä½¿ç”¨ Namespace çš„åœºæ™¯:**
```bash
# 1. å¤šç§Ÿæˆ·éš”ç¦»
# ä¸åŒå®¢æˆ·çš„åº”ç”¨ä¸èƒ½çœ‹åˆ°å½¼æ­¤çš„è¿›ç¨‹å’Œç½‘ç»œ

# 2. å¼€å‘ç¯å¢ƒéš”ç¦»
# å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒæœ‰ç‹¬ç«‹çš„ç½‘ç»œå’Œæ–‡ä»¶ç³»ç»Ÿè§†å›¾

# 3. å®‰å…¨éš”ç¦»
# æ¶æ„è¿›ç¨‹æ— æ³•çœ‹åˆ°å’Œè®¿é—®å…¶ä»–å®¹å™¨çš„èµ„æº
```

**ä½¿ç”¨ Cgroup çš„åœºæ™¯:**
```bash
# 1. é˜²æ­¢èµ„æºæ»¥ç”¨
# é™åˆ¶å•ä¸ªå®¹å™¨ä¸èƒ½å ç”¨è¶…è¿‡åˆ†é…çš„CPUå’Œå†…å­˜

# 2. ä¿è¯æœåŠ¡è´¨é‡  
# å…³é”®ä¸šåŠ¡åº”ç”¨è·å¾—è¶³å¤Ÿçš„èµ„æºä¿è¯

# 3. æˆæœ¬æ§åˆ¶
# æ ¹æ®ä»˜è´¹ç­‰çº§é™åˆ¶èµ„æºä½¿ç”¨é‡
```

##### ğŸ”„ ä¸¤è€…ç»“åˆä½¿ç”¨

åœ¨å®¹å™¨æŠ€æœ¯ä¸­ï¼ŒNamespace å’Œ Cgroup é€šå¸¸é…åˆä½¿ç”¨ï¼š

```yaml
# Docker å®¹å™¨é…ç½®ç¤ºä¾‹
version: '3'
services:
  web-app:
    image: nginx
    # Namespace éš”ç¦»é…ç½®
    network_mode: "bridge"    # ç‹¬ç«‹ç½‘ç»œ namespace
    pid: "container:app"      # å…±äº« PID namespace
    
    # Cgroup èµ„æºé™åˆ¶é…ç½®  
    deploy:
      resources:
        limits:
          cpus: '0.5'         # CPU é™åˆ¶
          memory: 512M        # å†…å­˜é™åˆ¶
        reservations:
          cpus: '0.25'        # CPU é¢„ç•™
          memory: 256M        # å†…å­˜é¢„ç•™
```

**åœ¨ Kubernetes ä¸­çš„ä½“ç°:**
```yaml
apiVersion: v1
kind: Pod
metadata:
  name: example-pod
spec:
  containers:
  - name: app
    image: nginx
    # Cgroup èµ„æºé™åˆ¶
    resources:
      limits:
        cpu: "500m"      # 0.5 CPU æ ¸å¿ƒ
        memory: "512Mi"  # 512 MB å†…å­˜
      requests:
        cpu: "250m"      # è¯·æ±‚ 0.25 CPU
        memory: "256Mi"  # è¯·æ±‚ 256 MB å†…å­˜
    
    # Namespace éš”ç¦»ï¼ˆK8s è‡ªåŠ¨ç®¡ç†ï¼‰
    # - Pod å†…å®¹å™¨å…±äº« Network/IPC/UTS namespace
    # - æ¯ä¸ªå®¹å™¨æœ‰ç‹¬ç«‹çš„ Mount/PID namespace
```

##### ğŸš¨ æ•…éšœæ’æŸ¥å·®å¼‚

**Namespace ç›¸å…³é—®é¢˜:**
```bash
# é—®é¢˜ï¼šå®¹å™¨æ— æ³•è®¿é—®å¤–éƒ¨ç½‘ç»œ
# æ’æŸ¥ï¼šæ£€æŸ¥ç½‘ç»œ namespace é…ç½®
ip netns exec container-ns ip route show
ip netns exec container-ns ping 8.8.8.8

# é—®é¢˜ï¼šè¿›ç¨‹çœ‹ä¸åˆ°é¢„æœŸçš„æ–‡ä»¶
# æ’æŸ¥ï¼šæ£€æŸ¥ mount namespace
mount | grep container
ls -la /proc/self/ns/mnt
```

**Cgroup ç›¸å…³é—®é¢˜:**
```bash
# é—®é¢˜ï¼šåº”ç”¨æ€§èƒ½æ…¢
# æ’æŸ¥ï¼šæ£€æŸ¥ CPU/å†…å­˜é™åˆ¶
cat /sys/fs/cgroup/cpu/docker/container-id/cpu.stat
cat /sys/fs/cgroup/memory/docker/container-id/memory.usage_in_bytes

# é—®é¢˜ï¼šè¿›ç¨‹è¢« OOM Kill
# æ’æŸ¥ï¼šæ£€æŸ¥å†…å­˜é™åˆ¶è®¾ç½®
dmesg | grep -i "killed process"
cat /sys/fs/cgroup/memory/docker/container-id/memory.limit_in_bytes
```

##### ğŸ“ˆ æ€§èƒ½å½±å“å¯¹æ¯”

| æ“ä½œç±»å‹ | Namespace å¼€é”€ | Cgroup å¼€é”€ |
|----------|----------------|-------------|
| **åˆ›å»ºé”€æ¯** | å¾ˆä½ | å¾ˆä½ |
| **åˆ‡æ¢ä¸Šä¸‹æ–‡** | ä½ | å‡ ä¹æ—  |
| **è¿è¡Œæ—¶ç›‘æ§** | å‡ ä¹æ—  | ä½ |
| **èµ„æºç»Ÿè®¡** | æ—  | ä½ |

**æ€»ç»“**: Namespace è´Ÿè´£"éš”ç¦»è§†å›¾"ï¼ŒCgroup è´Ÿè´£"é™åˆ¶ä½¿ç”¨"ï¼Œä¸¤è€…ç»“åˆæ‰èƒ½å®ç°å®Œæ•´çš„å®¹å™¨åŒ–ï¼

Namespace æä¾›äº†åœ¨æ€§èƒ½å’Œéš”ç¦»æ€§ä¹‹é—´çš„è‰¯å¥½å¹³è¡¡ï¼Œæ˜¯ç°ä»£å®¹å™¨æŠ€æœ¯ä¸å¯æˆ–ç¼ºçš„åŸºç¡€è®¾æ–½ã€‚