# SOCKS5ä»£ç†åè®®è¯´æ˜
## æ¦‚è¿°
SOCKS5æ˜¯ä¸€ä¸ªé€šç”¨çš„ç½‘ç»œä»£ç†åè®®ï¼ŒåŸºäºRFC 1928è§„èŒƒï¼Œæ˜¯è¿è¡Œåœ¨TCPè¿æ¥ä¸Šçš„åº”ç”¨å±‚åè®®ï¼Œèƒ½å¤Ÿä»£ç†ä»»æ„TCP/UDPæµé‡ã€‚ç›¸æ¯”HTTPä»£ç†ï¼ŒSOCKS5é‡‡ç”¨åè®®æ— å…³çš„è®¾è®¡ï¼Œé€šè¿‡é€æ˜å­—èŠ‚æµè½¬å‘å®ç°å¯¹ä¸Šå±‚åº”ç”¨çš„å®Œå…¨é€æ˜æ”¯æŒã€‚
## æ¦‚å¿µ
### SOCKS5 ä»£ç†çš„ç‰¹ç‚¹
SOCKS5èƒ½å¤Ÿä»£ç†ä»»æ„TCP/UDPæµé‡
| è®¾è®¡ç‰¹ç‚¹ | æŠ€æœ¯å®ç° | ä¼˜åŠ¿ |
|---------|----------|------|
| **åè®®æ— å…³** | ä¸è§£æåº”ç”¨å±‚åè®®å†…å®¹ | æ”¯æŒä»»æ„ä¸Šå±‚åè®® |
| **å­—èŠ‚æµè½¬å‘** | é€æ˜çš„æ•°æ®åŒ…è½¬å‘ | é›¶åè®®å¼€é”€ |
| **è¿æ¥ä»£ç†** | å»ºç«‹å®¢æˆ·ç«¯åˆ°ç›®æ ‡çš„éš§é“ | å¯¹åº”ç”¨å®Œå…¨é€æ˜ |
| **ä¼ è¾“å±‚æ”¯æŒ** | åŸç”ŸTCP/UDPæ”¯æŒ | åè®®è¦†ç›–é¢å¹¿ |

### SOCKS5çš„åè®®å®šä½
SOCKS5æ˜¯åŸºäºTCPçš„åº”ç”¨å±‚ä»£ç†åè®®ï¼Œå®ƒçš„ç½‘ç»œå±‚æ¬¡å®šä½
```
å®é™…ç½‘ç»œåè®®æ ˆï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åº”ç”¨å±‚: SOCKS5åè®® + ä»£ç†çš„åº”ç”¨æ•°æ®  â”‚  â† SOCKS5å·¥ä½œå±‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ä¼ è¾“å±‚: TCP (SOCKS5æ§åˆ¶è¿æ¥)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç½‘ç»œå±‚: IP                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ•°æ®é“¾è·¯å±‚: ä»¥å¤ªç½‘ç­‰                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
**é‡è¦è¯´æ˜**
- SOCKS5åè®®æœ¬èº«è¿è¡Œåœ¨**TCPè¿æ¥**ä¹‹ä¸Š
- å±äº**åº”ç”¨å±‚åè®®**ï¼Œä¸æ˜¯ä¼šè¯å±‚åè®®
- é€šè¿‡TCPè¿æ¥è¿›è¡Œåè®®åå•†å’Œæ§åˆ¶
- åå•†å®Œæˆåè¿›è¡Œé€æ˜çš„æ•°æ®è½¬å‘

### SOCKS5åè®®åœ¨ç½‘ç»œä¸­çš„å®é™…å·¥ä½œæ–¹å¼
```
å®¢æˆ·ç«¯ â†â†’ SOCKS5ä»£ç† â†â†’ ç›®æ ‡æœåŠ¡å™¨
   â”‚         â”‚           â”‚
   â”‚    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”     â”‚
   â”‚    â”‚TCPè¿æ¥1   â”‚     â”‚
   â”‚    â”‚(åè®®åå•†) â”‚     â”‚
   â”‚    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â”‚
   â”‚    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”     â”‚
   â”‚    â”‚TCPè¿æ¥2   â”‚     â”‚
   â”‚    â”‚(æ•°æ®è½¬å‘) â”‚     â”‚
   â”‚    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â”‚
   â”‚          â”‚           â”‚
 TCP/IP     TCP/IP      TCP/IP
```

**å…³é”®ç†è§£ï¼š**
- SOCKS5åè®®è¿è¡Œåœ¨æ™®é€šçš„TCPè¿æ¥ä¸Š
- ä½¿ç”¨æ ‡å‡†çš„IPæ•°æ®åŒ…è¿›è¡Œä¼ è¾“
- åå•†é˜¶æ®µé€šè¿‡TCPè¿æ¥äº¤æ¢æ§åˆ¶ä¿¡æ¯
- æ•°æ®è½¬å‘é˜¶æ®µè¿›è¡Œé€æ˜çš„å­—èŠ‚æµè½¬å‘

### SOCKS5åè®®æ•°æ®çš„å…·ä½“å°è£…æ–¹å¼
```
å®Œæ•´çš„ç½‘ç»œæ•°æ®åŒ…ç»“æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä»¥å¤ªç½‘å¸§å¤´ (14å­—èŠ‚)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ IPåŒ…å¤´ (20-60å­—èŠ‚,é€šå¸¸20å­—èŠ‚)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TCPåŒ…å¤´ (20-60å­—èŠ‚,é€šå¸¸20å­—èŠ‚)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SOCKS5åè®®æ•°æ® â† è¿™é‡Œå°±æ˜¯åå•†å†…å®¹!  â”‚
â”‚ ä¾‹å¦‚: 05 03 00 01 02 (è®¤è¯åå•†)     â”‚
â”‚ æˆ–è€…: 05 01 00 03 0B... (è¿æ¥è¯·æ±‚)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
1. **SOCKS5åå•†æ•°æ®** = TCPè¿æ¥çš„payloadï¼ˆæœ‰æ•ˆè½½è·ï¼‰
2. **TCPæŠ¥æ–‡æ®µ** = TCPå¤´(20-60å­—èŠ‚) + SOCKS5æ•°æ®
3. **IPæ•°æ®åŒ…** = IPå¤´(20-60å­—èŠ‚) + TCPæŠ¥æ–‡æ®µ 
4. **ä»¥å¤ªç½‘å¸§** = ä»¥å¤ªç½‘å¤´(14å­—èŠ‚) + IPæ•°æ®åŒ…

**åŒ…å¤´å¤§å°è¯´æ˜ï¼š**
- **IPåŒ…å¤´**: æœ€å°20å­—èŠ‚ï¼ˆæ— é€‰é¡¹ï¼‰ï¼Œæœ€å¤§60å­—èŠ‚ï¼ˆå«é€‰é¡¹ï¼‰
- **TCPåŒ…å¤´**: æœ€å°20å­—èŠ‚ï¼ˆæ— é€‰é¡¹ï¼‰ï¼Œæœ€å¤§60å­—èŠ‚ï¼ˆå«é€‰é¡¹ï¼‰
- **ä»¥å¤ªç½‘å¸§å¤´**: å›ºå®š14å­—èŠ‚
- **å®é™…ç½‘ç»œä¸­**: IPå’ŒTCPåŒ…å¤´é€šå¸¸éƒ½æ˜¯20å­—èŠ‚ï¼ˆä¸ä½¿ç”¨é€‰é¡¹ï¼‰

## åè®®æŠ¥æ–‡æ ¼å¼

### æµ‹è¯•å‘½ä»¤è¡Œ

å¯åŠ¨socks5 ä»£ç†: 
```
gost -L=socks5://admin:123456@0.0.0.0:8080
```

å®¢æˆ·ç«¯è¯·æ±‚
```
curl -v --socks5-hostname 127.0.0.1:8080 --proxy-user admin:123456 https://www.baidu.com/
```

### SOCKS5åè®®ç¤ºä¾‹
**å®Œæ•´çš„åè®®äº¤äº’ç¤ºä¾‹ï¼š**

```
æ­¥éª¤1: å®¢æˆ·ç«¯å‘èµ·è®¤è¯åå•†
å®¢æˆ·ç«¯ â†’ ä»£ç†: 05 03 00 01 02  (æ”¯æŒ3ç§è®¤è¯æ–¹æ³•)

æ­¥éª¤2: ä»£ç†é€‰æ‹©è®¤è¯æ–¹æ³•  
ä»£ç† â†’ å®¢æˆ·ç«¯: 05 02          (é€‰æ‹©ç”¨æˆ·åå¯†ç è®¤è¯)

æ­¥éª¤2.1: ç”¨æˆ·åå¯†ç è®¤è¯å­åå•†
å®¢æˆ·ç«¯ â†’ ä»£ç†: 01 05 61 64 6d 69 6e 06 31 32 33 34 35 36
               â†‘  â†‘  â†â”€â”€â”€ admin â”€â”€â†’ â†‘  â†â”€â”€â”€ 123456 â”€â”€â†’
               â”‚  â”‚                  â”‚
               â”‚  â””â”€ ULEN: ç”¨æˆ·åé•¿åº¦(5)    â””â”€ PLEN: å¯†ç é•¿åº¦(6)
               â””â”€â”€â”€â”€ VER: è®¤è¯å­åè®®ç‰ˆæœ¬(1)

ä»£ç† â†’ å®¢æˆ·ç«¯: 01 00          (è®¤è¯æˆåŠŸ)
               â†‘  â†‘
               â”‚  â””â”€ STATUS: æˆåŠŸ(0x00)
               â””â”€â”€â”€â”€ VER: è®¤è¯å­åè®®ç‰ˆæœ¬(1)

æ­¥éª¤3: å®¢æˆ·ç«¯å‘é€è¿æ¥è¯·æ±‚
å®¢æˆ·ç«¯ â†’ ä»£ç†: 05 01 00 03 0d 77 77 77 2e 62 61 69 64 75 2e 63 6f 6d 01 bb
               â†‘  â†‘  â†‘  â†‘  â†‘  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ www.baidu.com â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â†â”€â†’
               â”‚  â”‚  â”‚  â”‚  â”‚                                         â”‚
               â”‚  â”‚  â”‚  â”‚  â””â”€ åŸŸåé•¿åº¦(13å­—èŠ‚)                      ç«¯å£443
               â”‚  â”‚  â”‚  â””â”€â”€â”€â”€ ATYP: åŸŸåç±»å‹(0x03)
               â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€ RSV: ä¿ç•™å­—æ®µ(0x00)
               â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ CMD: è¿æ¥å‘½ä»¤(0x01)
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€VER: SOCKS5ç‰ˆæœ¬(0x05)

æ­¥éª¤4: ä»£ç†å“åº”è¿æ¥ç»“æœ
ä»£ç† â†’ å®¢æˆ·ç«¯: 05 00 00 01 00 00 00 00 00 00
               â†‘  â†‘  â†‘  â†‘  â†â”€â”€â”€ 0.0.0.0 â”€â”€â†’ â†â”€â†’
               â”‚  â”‚  â”‚  â”‚                   â””â”€ ç«¯å£0 (0000)
               â”‚  â”‚  â”‚  â””â”€ ATYP: IPv4ç±»å‹(0x01)
               â”‚  â”‚  â””â”€â”€â”€â”€ RSV: ä¿ç•™å­—æ®µ(0x00)
               â”‚  â””â”€â”€â”€â”€â”€â”€â”€ REP: æˆåŠŸ(0x00)
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ VER: SOCKS5ç‰ˆæœ¬(0x05)

æ­¥éª¤5: å¼€å§‹é€æ˜æ•°æ®è½¬å‘
å®¢æˆ·ç«¯ â†” ä»£ç† â†” www.baidu.com:443 (é€æ˜è½¬å‘HTTPSåŠ å¯†æ•°æ®)
```

SOCKS5ä»£ç†çš„å·¥ä½œåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µéƒ½æœ‰æ˜ç¡®çš„åè®®æ ¼å¼ï¼š

### é˜¶æ®µ1ï¼šè®¤è¯åå•†

å®¢æˆ·ç«¯ä¸ä»£ç†æœåŠ¡å™¨å»ºç«‹è¿æ¥åï¼Œé¦–å…ˆè¿›è¡Œè®¤è¯æ–¹æ³•çš„åå•†ã€‚

**åè®®äº¤äº’æµç¨‹ï¼š**
```
æ­¥éª¤1.1: å®¢æˆ·ç«¯å£°æ˜æ”¯æŒçš„è®¤è¯æ–¹æ³•
å®¢æˆ·ç«¯ â†’ ä»£ç†: [ç‰ˆæœ¬][æ–¹æ³•æ•°é‡][æ–¹æ³•åˆ—è¡¨]

æ­¥éª¤1.2: ä»£ç†é€‰æ‹©è®¤è¯æ–¹æ³•
ä»£ç† â†’ å®¢æˆ·ç«¯: [ç‰ˆæœ¬][é€‰ä¸­æ–¹æ³•]
```

**åè®®æ ¼å¼ï¼š**
```
å®¢æˆ·ç«¯ â†’ SOCKS5ä»£ç†ï¼šè®¤è¯æ–¹æ³•åå•†
+----+----------+----------+
|VER | NMETHODS | METHODS  |
+----+----------+----------+
| 1B |    1B    |  1-255B  |
+----+----------+----------+

SOCKS5ä»£ç† â†’ å®¢æˆ·ç«¯ï¼šé€‰æ‹©è®¤è¯æ–¹æ³•
+----+--------+
|VER | METHOD |
+----+--------+
| 1B |   1B   |
+----+--------+
```

**å­—æ®µè¯´æ˜ï¼š**
- `VER`: SOCKSç‰ˆæœ¬å·ï¼Œå›ºå®šä¸º0x05
- `NMETHODS`: å®¢æˆ·ç«¯æ”¯æŒçš„è®¤è¯æ–¹æ³•æ•°é‡
- `METHODS`: è®¤è¯æ–¹æ³•åˆ—è¡¨ï¼ˆ0x00=æ— è®¤è¯ï¼Œ0x01=GSSAPIï¼Œ0x02=ç”¨æˆ·åå¯†ç ï¼‰
- `METHOD`: ä»£ç†é€‰ä¸­çš„è®¤è¯æ–¹æ³•

### é˜¶æ®µ2ï¼šèº«ä»½è®¤è¯ï¼ˆå¦‚éœ€è¦ï¼‰

å¦‚æœé€‰æ‹©äº†éœ€è¦è®¤è¯çš„æ–¹æ³•ï¼ˆå¦‚ç”¨æˆ·åå¯†ç è®¤è¯ï¼‰ï¼Œåˆ™è¿›è¡Œå…·ä½“çš„è®¤è¯æµç¨‹ã€‚

**ç”¨æˆ·åå¯†ç è®¤è¯ç¤ºä¾‹ï¼š**
```
æ­¥éª¤2.1: å®¢æˆ·ç«¯å‘é€è®¤è¯ä¿¡æ¯
å®¢æˆ·ç«¯ â†’ ä»£ç†: [å­ç‰ˆæœ¬][ç”¨æˆ·åé•¿åº¦][ç”¨æˆ·å][å¯†ç é•¿åº¦][å¯†ç ]

æ­¥éª¤2.2: ä»£ç†éªŒè¯å¹¶å“åº”
ä»£ç† â†’ å®¢æˆ·ç«¯: [å­ç‰ˆæœ¬][è®¤è¯çŠ¶æ€]
```

**åè®®æ ¼å¼ï¼š**
```
ç”¨æˆ·åå¯†ç è®¤è¯è¯·æ±‚ï¼š
+----+------+----------+------+----------+
|VER | ULEN |  UNAME   | PLEN |  PASSWD  |
+----+------+----------+------+----------+
| 1B |  1B  | 1-255B   |  1B  | 1-255B   |
+----+------+----------+------+----------+

ç”¨æˆ·åå¯†ç è®¤è¯å“åº”ï¼š
+----+--------+
|VER | STATUS |
+----+--------+
| 1B |   1B   |
+----+--------+
```

### é˜¶æ®µ3ï¼šè¿æ¥è¯·æ±‚

è®¤è¯å®Œæˆåï¼Œå®¢æˆ·ç«¯å‘é€å…·ä½“çš„è¿æ¥è¯·æ±‚ï¼Œå‘ŠçŸ¥ä»£ç†è¦è¿æ¥çš„ç›®æ ‡åœ°å€ã€‚

**åè®®äº¤äº’æµç¨‹ï¼š**
```
æ­¥éª¤3.1: å®¢æˆ·ç«¯å‘é€è¿æ¥è¯·æ±‚
å®¢æˆ·ç«¯ â†’ ä»£ç†: [ç‰ˆæœ¬][å‘½ä»¤][ä¿ç•™][åœ°å€ç±»å‹][ç›®æ ‡åœ°å€][ç›®æ ‡ç«¯å£]

æ­¥éª¤3.2: ä»£ç†å“åº”è¿æ¥ç»“æœ
ä»£ç† â†’ å®¢æˆ·ç«¯: [ç‰ˆæœ¬][çŠ¶æ€][ä¿ç•™][åœ°å€ç±»å‹][ç»‘å®šåœ°å€][ç»‘å®šç«¯å£]
```

**åè®®æ ¼å¼ï¼š**
```
å®¢æˆ·ç«¯ â†’ SOCKS5ä»£ç†ï¼šè¿æ¥è¯·æ±‚
+----+-----+-------+------+----------+----------+
|VER | CMD |  RSV  | ATYP | DST.ADDR | DST.PORT |
+----+-----+-------+------+----------+----------+
| 1B | 1B  |  1B   | 1B   |  å˜é•¿    |    2B    |
+----+-----+-------+------+----------+----------+

SOCKS5ä»£ç† â†’ å®¢æˆ·ç«¯ï¼šè¿æ¥å“åº”
+----+-----+-------+------+----------+----------+
|VER | REP |  RSV  | ATYP | BND.ADDR | BND.PORT |
+----+-----+-------+------+----------+----------+
| 1B | 1B  |  1B   | 1B   |  å˜é•¿    |    2B    |
+----+-----+-------+------+----------+----------+
```

**é‡è¦å­—æ®µè¯´æ˜ï¼š**

| å­—æ®µ | å«ä¹‰ | é•¿åº¦ | å¸¸è§å€¼ | è¯´æ˜ |
|------|------|------|--------|------|
| `CMD` | å‘½ä»¤ç±»å‹ | 1B | 0x01/0x02/0x03 | TCPè¿æ¥/ç»‘å®š/UDPå…³è” |
| `ATYP` | åœ°å€ç±»å‹ | 1B | 0x01/0x03/0x04 | IPv4/åŸŸå/IPv6 |
| `REP` | å“åº”çŠ¶æ€ | 1B | 0x00/0x01/... | æˆåŠŸ/å¤±è´¥/å…¶ä»–é”™è¯¯ |
| `DST.ADDR` | ç›®æ ‡åœ°å€ | å˜é•¿ | - | æ ¹æ®ATYPå†³å®šæ ¼å¼ |
| `BND.ADDR` | ç»‘å®šåœ°å€ | å˜é•¿ | - | ä»£ç†æœåŠ¡å™¨çš„ç»‘å®šä¿¡æ¯ |

**åœ°å€å­—æ®µæ ¼å¼è¯¦è§£ï¼š**
```
ATYP = 0x01 (IPv4):
DST.ADDR = 4å­—èŠ‚ (IPv4åœ°å€)

ATYP = 0x03 (åŸŸå):  
DST.ADDR = 1å­—èŠ‚(é•¿åº¦) + Nå­—èŠ‚(åŸŸå)

ATYP = 0x04 (IPv6):
DST.ADDR = 16å­—èŠ‚ (IPv6åœ°å€)
```

### é˜¶æ®µ4ï¼šæ•°æ®è½¬å‘

è¿æ¥å»ºç«‹æˆåŠŸåï¼ŒSOCKS5ä»£ç†è¿›å…¥é€æ˜è½¬å‘æ¨¡å¼ï¼Œæˆä¸ºå®¢æˆ·ç«¯å’Œç›®æ ‡æœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®ä¼ è¾“ç®¡é“ã€‚

**æ•°æ®ä¼ è¾“ç‰¹ç‚¹ï¼š**
```
æ•°æ®æµå‘ï¼š
å®¢æˆ·ç«¯åº”ç”¨ â†” SOCKS5ä»£ç† â†” ç›®æ ‡æœåŠ¡å™¨
    â†“           â†“           â†“
  åº”ç”¨æ•°æ®    é€æ˜è½¬å‘    åº”ç”¨æ•°æ®
```

**å·¥ä½œåŸç†ï¼š**
- **å®Œå…¨é€æ˜**ï¼šä»£ç†ä¸è§£æã€ä¸ä¿®æ”¹åº”ç”¨å±‚æ•°æ®å†…å®¹
- **åŒå‘è½¬å‘**ï¼šåŒæ—¶å¤„ç†å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨å’ŒæœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯çš„æ•°æ®æµ
- **åè®®æ— å…³**ï¼šæ”¯æŒä»»æ„åŸºäºTCPçš„ä¸Šå±‚åè®®ï¼ˆHTTPã€HTTPSã€SSHã€æ•°æ®åº“ç­‰ï¼‰
- **å­—èŠ‚æµæ‹·è´**ï¼šçº¯ç²¹çš„å­—èŠ‚æµè½¬å‘ï¼Œæ— åè®®å¼€é”€

**è½¬å‘æµç¨‹ï¼š**
```
1. åå•†é˜¶æ®µå®Œæˆï¼Œä»£ç†å·²å»ºç«‹åˆ°ç›®æ ‡æœåŠ¡å™¨çš„è¿æ¥
2. å®¢æˆ·ç«¯å‘é€çš„æ‰€æœ‰åç»­æ•°æ® â†’ ç›´æ¥è½¬å‘ç»™ç›®æ ‡æœåŠ¡å™¨
3. ç›®æ ‡æœåŠ¡å™¨çš„å“åº”æ•°æ® â†’ ç›´æ¥è½¬å‘ç»™å®¢æˆ·ç«¯
4. è¿æ¥ä¿æŒï¼Œç›´åˆ°ä»»ä¸€ç«¯å…³é—­è¿æ¥
```

## UDP Over SOCKS5

UDPä»£ç†æ˜¯SOCKS5åè®®çš„ä¸€ä¸ªé‡è¦æ‰©å±•åŠŸèƒ½ï¼Œä¸TCPä»£ç†çš„ç›´æ¥è½¬å‘ä¸åŒï¼ŒUDPä»£ç†éœ€è¦é€šè¿‡ç‰¹æ®Šçš„å…³è”æœºåˆ¶æ¥å®ç°ã€‚

### æ ¸å¿ƒæ¦‚å¿µ

**UDPä»£ç†çš„å…³é”®ç‰¹ç‚¹ï¼šTCPæ§åˆ¶ + UDPæ•°æ®ä¼ è¾“**
```
UDPä»£ç†çš„åŒé‡è¿æ¥æ¨¡å‹ï¼š

æ§åˆ¶å±‚ï¼ˆTCPè¿æ¥ï¼‰ï¼š
å®¢æˆ·ç«¯ â†â†’ TCPè¿æ¥ï¼ˆUDP ASSOCIATEï¼‰ â†â†’ SOCKS5ä»£ç†
       â†‘
   å»ºç«‹UDPä¼šè¯ã€ç»´æŠ¤çŠ¶æ€ã€ä¼ è¾“æ§åˆ¶ä¿¡æ¯

æ•°æ®å±‚ï¼ˆUDPä¼ è¾“ï¼‰ï¼š
å®¢æˆ·ç«¯ â†â†’ UDPæ•°æ®åŒ… â†â†’ SOCKS5ä»£ç† â†â†’ UDPæ•°æ®åŒ… â†â†’ ç›®æ ‡æœåŠ¡å™¨
       â†‘                               â†‘
   SOCKS5å°è£…çš„UDPåŒ…               åŸå§‹UDPåŒ…
```

**ä¸TCPä»£ç†çš„æ ¹æœ¬åŒºåˆ«ï¼š**
```
TCPä»£ç†ï¼ˆçº¯TCPæ¨¡å¼ï¼‰ï¼š
å®¢æˆ·ç«¯ â†â†’ TCPè¿æ¥ â†â†’ SOCKS5ä»£ç† â†â†’ TCPè¿æ¥ â†â†’ ç›®æ ‡æœåŠ¡å™¨
      å•ä¸€TCPè¿æ¥å¤„ç†æ‰€æœ‰é€šä¿¡

UDPä»£ç†ï¼ˆTCP+UDPæ··åˆæ¨¡å¼ï¼‰ï¼š
å®¢æˆ·ç«¯ â†â†’ TCPè¿æ¥ï¼ˆæ§åˆ¶ï¼‰ â†â†’ SOCKS5ä»£ç†
       â†˜                     â†—
        UDPæ•°æ®åŒ… â†â†’ UDPç«¯å£ â†â†’ ç›®æ ‡æœåŠ¡å™¨
      TCPæ§åˆ¶ä¼šè¯ï¼ŒUDPä¼ è¾“æ•°æ®
```

### åŸºæœ¬æµç¨‹

#### 1. UDP ASSOCIATEè¯·æ±‚
```
å®¢æˆ·ç«¯é€šè¿‡TCPè¿æ¥å‘é€UDP ASSOCIATEè¯·æ±‚ï¼š
å®¢æˆ·ç«¯ â†’ SOCKS5ä»£ç†: 05 03 00 01 00 00 00 00 00 00
                    â†‘  â†‘  â†‘  â†‘  â†â”€â”€â”€ å®¢æˆ·ç«¯åœ°å€ â”€â”€â†’
                    â”‚  â”‚  â”‚  â””â”€ ATYP: IPv4
                    â”‚  â”‚  â””â”€â”€â”€â”€ RSV: ä¿ç•™å­—æ®µ  
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€ CMD: UDP ASSOCIATE (0x03)
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ VER: SOCKS5ç‰ˆæœ¬
```

#### 2. ä»£ç†å“åº”UDPç«¯å£
```
SOCKS5ä»£ç†è¿”å›UDPè½¬å‘ç«¯å£ï¼š
ä»£ç† â†’ å®¢æˆ·ç«¯: 05 00 00 01 7F 00 00 01 04 38
              â†‘  â†‘  â†‘  â†‘  â†â”€ 127.0.0.1 â”€â†’ â†â”€â†’
              â”‚  â”‚  â”‚  â”‚                   â””â”€ UDPç«¯å£1080
              â”‚  â”‚  â”‚  â””â”€ ATYP: IPv4
              â”‚  â”‚  â””â”€â”€â”€â”€ RSV: ä¿ç•™å­—æ®µ
              â”‚  â””â”€â”€â”€â”€â”€â”€â”€ REP: æˆåŠŸ
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ VER: SOCKS5ç‰ˆæœ¬
```

#### 3. UDPæ•°æ®ä¼ è¾“
```
UDPæ•°æ®åŒ…æ ¼å¼ï¼ˆå®¢æˆ·ç«¯ â†” SOCKS5ä»£ç†ï¼‰ï¼š
+----+------+------+----------+----------+----------+
|RSV | FRAG | ATYP | DST.ADDR | DST.PORT |   DATA   |
+----+------+------+----------+----------+----------+
| 2B |  1B  | 1B   |   å˜é•¿   |    2B    |   å˜é•¿   |
+----+------+------+----------+----------+----------+
```

### é‡è¦ç‰¹æ€§

**TCPæ§åˆ¶è¿æ¥çš„ä½œç”¨ï¼š**
```
1. å»ºç«‹UDPå…³è”ï¼ˆUDP ASSOCIATEå‘½ä»¤ï¼‰
2. ç»´æŠ¤UDPä¼šè¯çŠ¶æ€
3. æ§åˆ¶UDPä»£ç†çš„ç”Ÿå‘½å‘¨æœŸ
4. ä¼ è¾“é”™è¯¯ä¿¡æ¯

å…³é”®ï¼šTCPè¿æ¥æ–­å¼€ â†’ UDPä»£ç†ç«‹å³å¤±æ•ˆ
```

**å¸¸è§åº”ç”¨åœºæ™¯ï¼š**
- **DNSæŸ¥è¯¢ä»£ç†**ï¼šé€šè¿‡UDPè½¬å‘DNSæŸ¥è¯¢
- **æ¸¸æˆåŠ é€Ÿ**ï¼šä»£ç†æ¸¸æˆUDPæµé‡
- **æµåª’ä½“**ï¼šè½¬å‘éŸ³è§†é¢‘UDPæ•°æ®
- **P2Påº”ç”¨**ï¼šæ”¯æŒP2Påè®®çš„UDPé€šä¿¡

> ğŸ“– **è¯¦ç»†è¯´æ˜**ï¼šUDP ASSOCIATEæ˜¯SOCKS5ä¸­æœ€å¤æ‚çš„åŠŸèƒ½ï¼Œæ¶‰åŠä¼šè¯ç®¡ç†ã€åˆ†ç‰‡å¤„ç†ã€é”™è¯¯æ¢å¤ç­‰å¤šä¸ªæ–¹é¢ã€‚å®Œæ•´çš„å®ç°ç»†èŠ‚ã€ä»£ç ç¤ºä¾‹å’Œæœ€ä½³å®è·µè¯·å‚è€ƒï¼š[SOCKS5 UDP ASSOCIATE è¯¦è§£](./socks5_udp_associate.md)

## åè®®è¡Œä¸ºç‰¹æ€§

### DNSè§£ææœºåˆ¶

ä¸HTTPä»£ç†ä¸åŒï¼ŒSOCKS5æ”¯æŒä¸¤ç§DNSè§£ææ–¹å¼ï¼š

**HTTPä»£ç†çš„DNSè§£æé™åˆ¶ï¼š**
- HTTPä»£ç†åªèƒ½åœ¨ä»£ç†æœåŠ¡å™¨ç«¯è§£æDNS
- å®¢æˆ·ç«¯å‘é€çš„æ˜¯å®Œæ•´çš„URLï¼ˆå¦‚ `http://example.com/path`ï¼‰
- ä»£ç†ä»URLä¸­æå–åŸŸåå¹¶è¿›è¡ŒDNSè§£æ

**SOCKS5çš„DNSè§£æçµæ´»æ€§ï¼š**
SOCKS5é€šè¿‡ATYPå­—æ®µæä¾›äº†DNSè§£æçš„é€‰æ‹©æƒï¼š

#### 1. å®¢æˆ·ç«¯DNSè§£æ
```
å®¢æˆ·ç«¯è§£æ example.com â†’ IPåœ°å€
å®¢æˆ·ç«¯ â†’ SOCKS5(ATYP=0x01, IPv4åœ°å€) â†’ ç›®æ ‡æœåŠ¡å™¨
```

#### 2. ä»£ç†æœåŠ¡å™¨DNSè§£æ  
```
å®¢æˆ·ç«¯ â†’ SOCKS5(ATYP=0x03, åŸŸå) â†’ ä»£ç†è§£æåŸŸå â†’ ç›®æ ‡æœåŠ¡å™¨
```

#### å®é™…æ§åˆ¶æ–¹æ³•
```bash
# å®¢æˆ·ç«¯DNSè§£æï¼šå®¢æˆ·ç«¯å…ˆè§£æåŸŸåä¸ºIPï¼Œç„¶åå‘é€IPç»™ä»£ç†
curl --socks5 proxy:1080 http://example.com/

# ä»£ç†DNSè§£æï¼šå®¢æˆ·ç«¯ç›´æ¥å‘é€åŸŸåç»™ä»£ç†ï¼Œç”±ä»£ç†è§£æ
curl --socks5-hostname proxy:1080 http://example.com/
```

**é‡è¦è¯´æ˜ï¼š**
- `--socks5`ï¼šå®¢æˆ·ç«¯è§£æDNSï¼Œå‘é€ATYP=0x01(IPv4)ç»™ä»£ç†
- `--socks5-hostname`ï¼šä»£ç†è§£æDNSï¼Œå‘é€ATYP=0x03(åŸŸå)ç»™ä»£ç†

### åè®®èƒ½åŠ›å¯¹æ¯”

| ç‰¹æ€§ | SOCKS5 | HTTPä»£ç† | æŠ€æœ¯åŸå›  |
|------|---------|----------|----------|
| **åè®®æ”¯æŒ** | ä»»æ„TCP/UDPåè®® | ä¸»è¦HTTP/HTTPS | å­—èŠ‚æµé€æ˜ vs åè®®è§£æ |
| **DNSæ§åˆ¶** | å®¢æˆ·ç«¯æˆ–ä»£ç†å¯é€‰ | ä»…ä»£ç†ç«¯ | ATYPå­—æ®µæ”¯æŒIPå’ŒåŸŸå |
| **UDPæ”¯æŒ** | åŸç”Ÿæ”¯æŒ | ä¸æ”¯æŒ | åè®®è®¾è®¡åŒ…å«UDP |
| **ç¼“å­˜èƒ½åŠ›** | æ— ç¼“å­˜ | æ”¯æŒç¼“å­˜ | é€æ˜è½¬å‘ vs å†…å®¹ç†è§£ |
| **è¿æ¥å¼€é”€** | æœ€å°å¼€é”€ | HTTPå¤´å¼€é”€ | äºŒè¿›åˆ¶åè®® vs æ–‡æœ¬åè®® |

## åè®®è°ƒè¯•

### æŠ“åŒ…åˆ†æ
```bash
# ä½¿ç”¨tcpdumpæŠ“å–SOCKS5æµé‡
sudo tcpdump -i any -X 'port 1080'

```

### åè®®æµ‹è¯•
```bash
# æµ‹è¯•SOCKS5ä»£ç†TCPè¿æ¥
curl --socks5 localhost:1080 http://httpbin.org/ip

# æµ‹è¯•UDPæ”¯æŒï¼ˆé€šè¿‡SOCKS5ä»£ç†ï¼‰
# æ³¨æ„ï¼šå¤§å¤šæ•°å·¥å…·ä¸ç›´æ¥æ”¯æŒSOCKS5 UDPï¼Œéœ€è¦ç‰¹æ®Šé…ç½®

# æ–¹æ³•1ï¼šä½¿ç”¨æ”¯æŒSOCKS5 UDPçš„å·¥å…·
# ä¾‹å¦‚ï¼šproxychainsé…ç½®åä½¿ç”¨dig
echo "socks5 127.0.0.1 1080" > /tmp/proxychains.conf
proxychains4 -f /tmp/proxychains.conf dig google.com

# æ–¹æ³•2ï¼šæµ‹è¯•SOCKS5æœåŠ¡å™¨çš„UDPå…³è”åŠŸèƒ½
# æ£€æŸ¥UDP ASSOCIATEå‘½ä»¤æ˜¯å¦è¢«æ”¯æŒ
nc -u localhost 1080  # è¿™åªèƒ½æµ‹è¯•ç«¯å£å¯è¾¾æ€§

# æ–¹æ³•3ï¼šä½¿ç”¨ç¼–ç¨‹æ–¹å¼æµ‹è¯•UDPè½¬å‘
# ï¼ˆéœ€è¦å®ç°SOCKS5 UDP ASSOCIATEåè®®ï¼‰
```

## å®é™…åº”ç”¨æ¡ˆä¾‹

### é€šç”¨ç½‘ç»œéš§é“åœºæ™¯

#### å…¸å‹éƒ¨ç½²æ¶æ„
```
å„ç±»åº”ç”¨ â†’ SOCKS5ä»£ç† â†’ ç›®æ ‡æœåŠ¡
    â†“         â†“           â†“
åè®®æ— å…³   é€æ˜è½¬å‘    åŸç”Ÿåè®®
```

#### å¸¸è§åº”ç”¨åœºæ™¯
| åº”ç”¨ç±»å‹ | åè®® | SOCKS5ä¼˜åŠ¿ |
|---------|------|------------|
| æ¸¸æˆåŠ é€Ÿ | æ¸¸æˆåè®® | ä½å»¶è¿Ÿé€æ˜è½¬å‘ |
| æ•°æ®åº“è¿æ¥ | MySQL/PostgreSQL | åŸç”Ÿåè®®æ”¯æŒ |
| SSHéš§é“ | SSHåè®® | å®Œå…¨é€æ˜ä»£ç† |
| P2Pä¸‹è½½ | BitTorrent | UDPæ”¯æŒ |
| é‚®ä»¶å®¢æˆ·ç«¯ | SMTP/IMAP | å¤šåè®®å…¼å®¹ |

### è½¯ä»¶é…ç½®ç¤ºä¾‹

å¤§å¤šæ•°æ”¯æŒä»£ç†çš„è½¯ä»¶éƒ½æ”¯æŒSOCKS5é…ç½®ï¼š

```bash
# æµè§ˆå™¨é…ç½®
SOCKSä¸»æœº: proxy.example.com
ç«¯å£: 1080
SOCKSç‰ˆæœ¬: 5

# ç»ˆç«¯å·¥å…·é…ç½®
export ALL_PROXY=socks5://proxy:1080
```

## ä¸»æµSOCKS5å®ç°

### åŠ å¯†ä»£ç†å®ç°ï¼ˆå¦‚Shadowsocksï¼‰
```bash
# ShadowsocksåŸºäºSOCKS5åè®®çš„åŠ å¯†ä»£ç†å®ç°
ss-server -s 0.0.0.0 -p 8388 -k password -m aes-256-gcm
ss-local -s server_ip -p 8388 -k password -l 1080

# è¯´æ˜ï¼šShadowsocksæ˜¯åœ¨SOCKS5åŸºç¡€ä¸Šå¢åŠ äº†åŠ å¯†å±‚çš„å®ç°
# ss-localåˆ›å»ºæœ¬åœ°SOCKS5ä»£ç†(1080ç«¯å£)ï¼Œæ•°æ®åŠ å¯†åå‘é€ç»™ss-server
```

### Goè¯­è¨€ç®€åŒ–å®ç°
```go
package main

import (
    "encoding/binary"
    "fmt"
    "io"
    "net"
    "time"
)

type SOCKS5Server struct {
    addr string
}

func (s *SOCKS5Server) Start() error {
    listener, err := net.Listen("tcp", s.addr)
    if err != nil {
        return err
    }
    defer listener.Close()
    
    for {
        conn, err := listener.Accept()
        if err != nil {
            continue
        }
        go s.handleClient(conn)
    }
}

func (s *SOCKS5Server) handleClient(conn net.Conn) {
    defer conn.Close()
    
    // 1. è®¤è¯åå•†
    if err := s.authenticate(conn); err != nil {
        return
    }
    
    // 2. å¤„ç†è¿æ¥è¯·æ±‚
    targetAddr, cmd, err := s.handleRequest(conn)
    if err != nil {
        return
    }
    
    // 3. å»ºç«‹éš§é“
    if cmd == 0x01 { // TCPè¿æ¥
        s.handleTCPConnection(conn, targetAddr)
    }
}

func (s *SOCKS5Server) authenticate(conn net.Conn) error {
    buffer := make([]byte, 256)
    n, err := conn.Read(buffer)
    if err != nil {
        return err
    }
    
    if n < 3 || buffer[0] != 0x05 {
        return fmt.Errorf("æ— æ•ˆSOCKS5ç‰ˆæœ¬")
    }
    
    // é€‰æ‹©æ— è®¤è¯
    response := []byte{0x05, 0x00}
    _, err = conn.Write(response)
    return err
}

func (s *SOCKS5Server) handleRequest(conn net.Conn) (string, byte, error) {
    buffer := make([]byte, 1024)
    n, err := conn.Read(buffer)
    if err != nil {
        return "", 0, err
    }
    
    if n < 7 || buffer[0] != 0x05 {
        return "", 0, fmt.Errorf("æ— æ•ˆè¯·æ±‚")
    }
    
    cmd := buffer[1]
    atyp := buffer[3]
    
    var targetAddr string
    switch atyp {
    case 0x01: // IPv4
        ip := net.IP(buffer[4:8])
        port := binary.BigEndian.Uint16(buffer[8:10])
        targetAddr = fmt.Sprintf("%s:%d", ip.String(), port)
    case 0x03: // åŸŸå
        domainLen := int(buffer[4])
        domain := string(buffer[5 : 5+domainLen])
        port := binary.BigEndian.Uint16(buffer[5+domainLen : 7+domainLen])
        targetAddr = fmt.Sprintf("%s:%d", domain, port)
    default:
        return "", 0, fmt.Errorf("ä¸æ”¯æŒçš„åœ°å€ç±»å‹")
    }
    
    // å‘é€æˆåŠŸå“åº”
    response := []byte{0x05, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}
    conn.Write(response)
    
    return targetAddr, cmd, nil
}

func (s *SOCKS5Server) handleTCPConnection(clientConn net.Conn, targetAddr string) {
    targetConn, err := net.DialTimeout("tcp", targetAddr, 10*time.Second)
    if err != nil {
        return
    }
    defer targetConn.Close()
    
    // åŒå‘æ•°æ®è½¬å‘
    go io.Copy(targetConn, clientConn)
    io.Copy(clientConn, targetConn)
}

func main() {
    server := &SOCKS5Server{addr: ":1080"}
    fmt.Println("SOCKS5ä»£ç†æœåŠ¡å™¨å¯åŠ¨åœ¨ç«¯å£1080")
    server.Start()
}
```

**å®ç°è¯´æ˜ï¼š**
- å®Œæ•´å®ç°äº†SOCKS5åè®®çš„ä¸‰ä¸ªé˜¶æ®µ
- æ”¯æŒIPv4å’ŒåŸŸååœ°å€ç±»å‹
- æä¾›é€æ˜çš„TCPæµé‡è½¬å‘
- é‡‡ç”¨Goåç¨‹å®ç°å¹¶å‘å¤„ç†

## å®¢æˆ·ç«¯ä½¿ç”¨æŒ‡å—

### å‘½ä»¤è¡Œå·¥å…·

#### curlä½¿ç”¨ç¤ºä¾‹
```bash
# SOCKS5ä»£ç†ï¼ˆå®¢æˆ·ç«¯DNSè§£æï¼‰
curl --socks5 localhost:1080 https://httpbin.org/ip

# SOCKS5ä»£ç†ï¼ˆä»£ç†DNSè§£æï¼‰
curl --socks5-hostname localhost:1080 https://httpbin.org/ip


# å¸¦è®¤è¯çš„SOCKS5
curl --socks5 user:pass@localhost:1080 https://httpbin.org/ip
```

#### SSHä½¿ç”¨ç¤ºä¾‹
```bash
# SSHé€šè¿‡SOCKS5ä»£ç†
ssh -o ProxyCommand='nc -X 5 -x localhost:1080 %h %p' user@server

# SSHåŠ¨æ€ç«¯å£è½¬å‘ï¼ˆå»ºç«‹æœ¬åœ°SOCKS5ä»£ç†ï¼‰,åå°è¿è¡ŒSSHéš§é“
ssh -D 1080 user@server
```
**SSHåŠ¨æ€è½¬å‘è¯´æ˜ï¼š**
- `-D 1080`ï¼šåœ¨æœ¬åœ°1080ç«¯å£åˆ›å»ºSOCKS5ä»£ç†
- `-f`ï¼šåå°è¿è¡Œ
- `-N`ï¼šä¸æ‰§è¡Œè¿œç¨‹å‘½ä»¤ï¼Œä»…å»ºç«‹éš§é“
- é€šè¿‡SSHæœåŠ¡å™¨è½¬å‘æ‰€æœ‰SOCKS5æµé‡


#### Pythonç¤ºä¾‹
```python
import socks
import socket

# è®¾ç½®SOCKS5ä»£ç†
socks.set_default_proxy(socks.SOCKS5, "localhost", 1080)
socket.socket = socks.socksocket

# æ­£å¸¸ä½¿ç”¨socket
import requests
response = requests.get("http://httpbin.org/ip")
```

#### Goè¯­è¨€ç¤ºä¾‹
```go
import (
    "golang.org/x/net/proxy"
    "net/http"
)

// é€šè¿‡SOCKS5ä»£ç†å‘é€HTTPè¯·æ±‚
dialer, err := proxy.SOCKS5("tcp", "localhost:1080", nil, proxy.Direct)
transport := &http.Transport{Dial: dialer.Dial}
client := &http.Client{Transport: transport}

resp, err := client.Get("http://httpbin.org/ip")
```

## æ€§èƒ½å’Œä¼˜åŒ–

### è¿æ¥å¤ç”¨ç­–ç•¥

è™½ç„¶SOCKS5åè®®æœ¬èº«ä¸æ”¯æŒå¤šè·¯å¤ç”¨ï¼Œä½†å¯ä»¥é€šè¿‡åº”ç”¨å±‚å®ç°ï¼š

```go
// è¿æ¥æ± ç®¡ç†
type SOCKS5Pool struct {
    proxy    string
    pool     chan net.Conn
    maxConns int
}

func (p *SOCKS5Pool) GetConnection() net.Conn {
    select {
    case conn := <-p.pool:
        return conn
    default:
        return p.createConnection()
    }
}

func (p *SOCKS5Pool) ReturnConnection(conn net.Conn) {
    select {
    case p.pool <- conn:
    default:
        conn.Close()
    }
}
```

### UDPæ€§èƒ½ä¼˜åŒ–

```go
// UDPå…³è”ä¼˜åŒ–
type UDPRelay struct {
    sessions map[string]*UDPSession
    timeout  time.Duration
}

func (ur *UDPRelay) handleUDPPacket(data []byte, addr *net.UDPAddr) {
    sessionKey := addr.String()
    
    session, exists := ur.sessions[sessionKey]
    if !exists {
        session = ur.createUDPSession(addr)
        ur.sessions[sessionKey] = session
    }
    
    session.forwardPacket(data)
}
```

## å®‰å…¨è€ƒè™‘

### å¨èƒæ¨¡å‹

| å¨èƒç±»å‹ | SOCKS5å½±å“ | é˜²æŠ¤æªæ–½ |
|---------|------------|----------|
| æµé‡å—…æ¢ | âŒ æ˜æ–‡ä¼ è¾“ | ç»“åˆåŠ å¯†éš§é“(å¦‚SSã€V2Rayç­‰) |
| èº«ä»½ä¼ªé€  | âš ï¸ è®¤è¯å¯é€‰ | å¯ç”¨ç”¨æˆ·åå¯†ç è®¤è¯ |
| ä¸­é—´äººæ”»å‡» | âŒ æ— å†…ç½®é˜²æŠ¤ | ä½¿ç”¨åŠ å¯†ä»£ç†åè®® |
| æµé‡åˆ†æ | âš ï¸ ç‰¹å¾æ˜æ˜¾ | æµé‡æ··æ·†æŠ€æœ¯ |

### æœ€ä½³å®è·µ

1. **åŠ å¯†ä¼ è¾“**ï¼šç»“åˆåŠ å¯†ä»£ç†åè®®ï¼ˆå¦‚Shadowsocksã€V2Rayç­‰ï¼‰
2. **è®¿é—®æ§åˆ¶**ï¼šé™åˆ¶ä»£ç†ä½¿ç”¨çš„IPèŒƒå›´å’Œç«¯å£
3. **è®¤è¯æœºåˆ¶**ï¼šå¯ç”¨ç”¨æˆ·åå¯†ç è®¤è¯
4. **æ—¥å¿—ç›‘æ§**ï¼šè®°å½•å’Œåˆ†æä»£ç†ä½¿ç”¨æƒ…å†µ

## æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

#### è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥SOCKS5æœåŠ¡å¯è¾¾æ€§
telnet proxy.example.com 1080

# æµ‹è¯•SOCKS5åè®®
curl -v --socks5 proxy:1080 http://httpbin.org/ip
```

#### è®¤è¯é—®é¢˜
```bash
# SOCKS5è®¤è¯å¤±è´¥é€šå¸¸è¿”å›ï¼š
# 05 01  (ç‰ˆæœ¬5ï¼Œè®¤è¯å¤±è´¥)

# è§£å†³æ–¹æ¡ˆï¼š
curl --socks5 user:pass@proxy:1080 http://example.com/
```

#### UDPä¸å·¥ä½œ
```bash
# æ£€æŸ¥UDPå…³è”æ”¯æŒ
# å¾ˆå¤šSOCKS5ä»£ç†ä¸å®Œæ•´æ”¯æŒUDP

# æµ‹è¯•UDPåŠŸèƒ½çš„æ­£ç¡®æ–¹æ³•ï¼š
# 1. æ£€æŸ¥ä»£ç†æ˜¯å¦å“åº”UDP ASSOCIATEå‘½ä»¤
curl -v --socks5 proxy:1080 --connect-timeout 5 http://httpbin.org/ip

# 2. ä½¿ç”¨æ”¯æŒSOCKS5 UDPçš„ä¸“é—¨å·¥å…·
# ï¼ˆå¤§å¤šæ•°æ ‡å‡†å·¥å…·å¦‚digä¸æ”¯æŒSOCKS5 UDPï¼‰

# 3. ç¼–ç¨‹æ–¹å¼æµ‹è¯•UDP ASSOCIATE
# å‘é€CMD=0x03ï¼ˆUDP ASSOCIATEï¼‰å‘½ä»¤ç»™SOCKS5ä»£ç†
```

### è°ƒè¯•å·¥å…·

```bash
# åè®®åˆ†æ
tcpdump -i any -X 'port 1080'

# è¿æ¥æµ‹è¯•
netcat -v proxy.example.com 1080

# æ€§èƒ½æµ‹è¯•
iperf3 -c target-server --socks5 proxy:1080
```

## æ€»ç»“

### åè®®æ ¸å¿ƒç‰¹ç‚¹

1. **é€šç”¨æ€§**ï¼šæ”¯æŒä»»æ„TCP/UDPåè®®ï¼ŒçœŸæ­£çš„åè®®æ— å…³ä»£ç†
2. **é€æ˜æ€§**ï¼šå¯¹ä¸Šå±‚åº”ç”¨å®Œå…¨é€æ˜ï¼Œæ— éœ€åè®®é€‚é…
3. **é«˜æ•ˆæ€§**ï¼šäºŒè¿›åˆ¶åè®®ï¼Œæœ€å°åŒ–åè®®å¼€é”€
4. **çµæ´»æ€§**ï¼šæ”¯æŒå¤šç§è®¤è¯æ–¹å¼å’Œåœ°å€ç±»å‹

### ä¸å…¶ä»–ä»£ç†åè®®å¯¹æ¯”

| ç‰¹æ€§ | SOCKS5 | HTTPä»£ç† | é€æ˜ä»£ç† |
|------|--------|----------|----------|
| åè®®æ”¯æŒ | ä»»æ„åè®® | HTTP/HTTPS | ä»»æ„åè®® |
| é…ç½®å¤æ‚åº¦ | ä¸­ç­‰ | ç®€å• | å¤æ‚ |
| åº”ç”¨å…¼å®¹æ€§ | éœ€è¦æ”¯æŒ | å¹¿æ³›æ”¯æŒ | å®Œå…¨é€æ˜ |
| æ€§èƒ½å¼€é”€ | ä½ | ä¸­ç­‰ | æœ€ä½ |

### é€‰æ‹©ä¸åŒä»£ç†çš„å»ºè®®

| åœºæ™¯ | æ¨èæ–¹æ¡ˆ | åŸå›  |
|------|----------|------|
| é€šç”¨åº”ç”¨ä»£ç† | SOCKS5 | åè®®æ”¯æŒæœ€å¹¿æ³› |
| ä¼ä¸šHTTPä»£ç† | HTTPä»£ç† | å¯ä½¿ç”¨å†…å®¹ç®¡ç†å’Œç¼“å­˜ |
| æ¸¸æˆåŠ é€Ÿ | SOCKS5 | ä½å»¶è¿Ÿé€æ˜è½¬å‘ |
| å¼€å‘è°ƒè¯• | SOCKS5 | æ”¯æŒä»»æ„åè®®æµ‹è¯• |

---

> ğŸ’¡ **ç†è§£è¦ç‚¹**ï¼šSOCKS5çš„æ ¸å¿ƒä»·å€¼åœ¨äº"é€šç”¨æ€§"å’Œ"é€æ˜æ€§"ï¼Œå®ƒä¸å…³å¿ƒä¸Šå±‚è·‘ä»€ä¹ˆåè®®ï¼Œåªè´Ÿè´£å»ºç«‹å¯é çš„ç½‘ç»œéš§é“ã€‚è¿™ç§è®¾è®¡å“²å­¦ä½¿å…¶æˆä¸ºæœ€é€šç”¨çš„ä»£ç†åè®®ã€‚
